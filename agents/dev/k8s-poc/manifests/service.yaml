apiVersion: v1
kind: Service
metadata:
  name: devagent
  namespace: devagent-poc
  labels:
    app.kubernetes.io/name: devagent
    app.kubernetes.io/component: service
    app.kubernetes.io/part-of: saas-factory
    app.kubernetes.io/version: "1.0.0"
  annotations:
    description: "DevAgent service for Night 68 K8s POC"
    service.beta.kubernetes.io/external-traffic: OnlyLocal
    # Cloud Load Balancer annotations for GKE
    cloud.google.com/neg: '{"ingress": true}'
    cloud.google.com/backend-config: '{"default": "devagent-backend-config"}'
spec:
  type: ClusterIP
  ports:
  - name: http
    port: 8083
    targetPort: http
    protocol: TCP
  - name: metrics
    port: 8084
    targetPort: metrics
    protocol: TCP
  - name: node-metrics
    port: 9100
    targetPort: node-metrics
    protocol: TCP
  selector:
    app.kubernetes.io/name: devagent
    app.kubernetes.io/component: agent
  sessionAffinity: None
---
# LoadBalancer service for external access (alternative to Ingress)
apiVersion: v1
kind: Service
metadata:
  name: devagent-external
  namespace: devagent-poc
  labels:
    app.kubernetes.io/name: devagent
    app.kubernetes.io/component: external-service
    app.kubernetes.io/part-of: saas-factory
  annotations:
    description: "DevAgent external service for testing"
    # GKE Load Balancer annotations
    cloud.google.com/load-balancer-type: "External"
    networking.gke.io/load-balancer-type: "External"
spec:
  type: LoadBalancer
  ports:
  - name: http
    port: 80
    targetPort: 8083
    protocol: TCP
  - name: https
    port: 443
    targetPort: 8083
    protocol: TCP
  selector:
    app.kubernetes.io/name: devagent
    app.kubernetes.io/component: agent
  sessionAffinity: None
  loadBalancerSourceRanges:
  # Restrict access to specific IP ranges (replace with actual ranges)
  - "0.0.0.0/0"  # Allow all for POC - restrict in production
---
# Headless service for StatefulSet-like behavior (if needed)
apiVersion: v1
kind: Service
metadata:
  name: devagent-headless
  namespace: devagent-poc
  labels:
    app.kubernetes.io/name: devagent
    app.kubernetes.io/component: headless-service
    app.kubernetes.io/part-of: saas-factory
  annotations:
    description: "DevAgent headless service for direct pod access"
spec:
  type: ClusterIP
  clusterIP: None
  ports:
  - name: http
    port: 8083
    targetPort: http
    protocol: TCP
  selector:
    app.kubernetes.io/name: devagent
    app.kubernetes.io/component: agent
  publishNotReadyAddresses: true 
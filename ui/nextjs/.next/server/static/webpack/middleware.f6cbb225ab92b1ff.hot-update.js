"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
self["webpackHotUpdate_N_E"]("middleware",{

/***/ "(middleware)/./src/lib/correlation-id.ts":
/*!***********************************!*\
  !*** ./src/lib/correlation-id.ts ***!
  \***********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   addCorrelationId: () => (/* binding */ addCorrelationId),\n/* harmony export */   correlationAwareFetch: () => (/* binding */ correlationAwareFetch),\n/* harmony export */   correlationManager: () => (/* binding */ correlationManager),\n/* harmony export */   createCorrelationAwareFetch: () => (/* binding */ createCorrelationAwareFetch),\n/* harmony export */   createCorrelationContext: () => (/* binding */ createCorrelationContext),\n/* harmony export */   createFetchOptionsWithCorrelation: () => (/* binding */ createFetchOptionsWithCorrelation),\n/* harmony export */   createHeadersWithCorrelation: () => (/* binding */ createHeadersWithCorrelation),\n/* harmony export */   extractCorrelationId: () => (/* binding */ extractCorrelationId),\n/* harmony export */   generateCorrelationId: () => (/* binding */ generateCorrelationId),\n/* harmony export */   generateSpanId: () => (/* binding */ generateSpanId),\n/* harmony export */   generateTraceId: () => (/* binding */ generateTraceId),\n/* harmony export */   logWithCorrelation: () => (/* binding */ logWithCorrelation),\n/* harmony export */   withCorrelationContext: () => (/* binding */ withCorrelationContext)\n/* harmony export */ });\n// Correlation ID service for request tracing and observability\n// Configuration\nconst CORRELATION_ID_HEADER = process.env.NEXT_PUBLIC_CORRELATION_ID_HEADER || 'X-Correlation-ID';\nconst CORRELATION_ID_LENGTH = parseInt(process.env.NEXT_PUBLIC_CORRELATION_ID_LENGTH || '16', 10);\n// Generate a unique correlation ID\nfunction generateCorrelationId() {\n    const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';\n    let result = '';\n    for(let i = 0; i < CORRELATION_ID_LENGTH; i++){\n        result += chars.charAt(Math.floor(Math.random() * chars.length));\n    }\n    return result;\n}\n// Generate a trace ID (longer, more unique identifier)\nfunction generateTraceId() {\n    return generateCorrelationId() + generateCorrelationId();\n}\n// Generate a span ID (shorter identifier for individual operations)\nfunction generateSpanId() {\n    return generateCorrelationId().substring(0, 8);\n}\n// Create a new correlation context\nfunction createCorrelationContext(parentContext, metadata = {}) {\n    const now = new Date().toISOString();\n    return {\n        id: parentContext?.id || generateCorrelationId(),\n        parentId: parentContext?.parentId,\n        traceId: parentContext?.traceId || generateTraceId(),\n        spanId: generateSpanId(),\n        userId: parentContext?.userId,\n        sessionId: parentContext?.sessionId,\n        requestId: parentContext?.requestId || generateCorrelationId(),\n        timestamp: now,\n        metadata: {\n            ...parentContext?.metadata,\n            ...metadata,\n            created_at: now\n        }\n    };\n}\n// Extract correlation ID from headers\nfunction extractCorrelationId(headers) {\n    if (headers instanceof Headers) {\n        return headers.get(CORRELATION_ID_HEADER) || null;\n    }\n    return headers[CORRELATION_ID_HEADER] || null;\n}\n// Add correlation ID to headers\nfunction addCorrelationId(headers, correlationId) {\n    if (headers instanceof Headers) {\n        headers.set(CORRELATION_ID_HEADER, correlationId);\n    } else {\n        headers[CORRELATION_ID_HEADER] = correlationId;\n    }\n}\n// Create headers with correlation ID\nfunction createHeadersWithCorrelation(correlationId, additionalHeaders = {}) {\n    return {\n        [CORRELATION_ID_HEADER]: correlationId,\n        'Content-Type': 'application/json',\n        ...additionalHeaders\n    };\n}\n// Create fetch options with correlation ID\nfunction createFetchOptionsWithCorrelation(correlationId, options = {}) {\n    return {\n        ...options,\n        headers: {\n            ...createHeadersWithCorrelation(correlationId),\n            ...options.headers\n        }\n    };\n}\n// Correlation context manager for React components\nclass CorrelationContextManager {\n    // Set the current correlation context\n    setContext(context) {\n        this.currentContext = context;\n        this.notifyListeners();\n    }\n    // Get the current correlation context\n    getContext() {\n        return this.currentContext;\n    }\n    // Create a child context\n    createChildContext(metadata = {}) {\n        if (!this.currentContext) {\n            return createCorrelationContext({}, metadata);\n        }\n        return createCorrelationContext(this.currentContext, {\n            ...metadata,\n            parent_correlation_id: this.currentContext.id\n        });\n    }\n    // Update the current context with additional metadata\n    updateContext(metadata) {\n        if (this.currentContext) {\n            this.currentContext.metadata = {\n                ...this.currentContext.metadata,\n                ...metadata,\n                updated_at: new Date().toISOString()\n            };\n            this.notifyListeners();\n        }\n    }\n    // Clear the current context\n    clearContext() {\n        this.currentContext = null;\n        this.notifyListeners();\n    }\n    // Subscribe to context changes\n    subscribe(listener) {\n        this.listeners.add(listener);\n        return ()=>{\n            this.listeners.delete(listener);\n        };\n    }\n    // Notify all listeners of context changes\n    notifyListeners() {\n        this.listeners.forEach((listener)=>{\n            try {\n                listener(this.currentContext);\n            } catch (error) {\n                console.error('Error in correlation context listener:', error);\n            }\n        });\n    }\n    // Extract correlation ID from headers\n    extractFromHeaders(headers) {\n        const correlationId = headers['x-correlation-id'] || headers['X-Correlation-ID'];\n        if (!correlationId) return null;\n        const context = this.getContext(correlationId);\n        if (context) {\n            this.setCurrentContext(context);\n            return context;\n        }\n        // Create new context from headers, preserving the incoming correlation ID\n        const newContext = {\n            correlationId: correlationId,\n            requestId: headers['x-request-id'] || headers['X-Request-ID'] || uuidv4(),\n            parentId: headers['x-parent-id'] || headers['X-Parent-ID'] || undefined,\n            spanId: headers['x-span-id'] || headers['X-Span-ID'] || uuidv4(),\n            traceId: headers['x-trace-id'] || headers['X-Trace-ID'] || correlationId,\n            userId: headers['x-user-id'] || headers['X-User-ID'] || undefined,\n            tenantId: headers['x-tenant-id'] || headers['X-Tenant-ID'] || undefined,\n            sessionId: headers['x-session-id'] || headers['X-Session-ID'] || undefined,\n            timestamp: parseInt(headers['x-timestamp'] || headers['X-Timestamp'] || Date.now().toString()),\n            metadata: {\n                service: headers['x-service'] || headers['X-Service'] || 'unknown',\n                version: process.env.NEXT_PUBLIC_APP_VERSION || '1.0.0',\n                environment: \"development\" || 0\n            }\n        };\n        this.setCurrentContext(newContext);\n        return newContext;\n    }\n    constructor(){\n        this.currentContext = null;\n        this.listeners = new Set();\n    }\n}\n// Export singleton instance\nconst correlationManager = new CorrelationContextManager();\n// Utility function to log with correlation context\nfunction logWithCorrelation(level, message, data) {\n    const context = correlationManager.getContext();\n    const logData = {\n        message,\n        data,\n        correlation_id: context?.id,\n        trace_id: context?.traceId,\n        span_id: context?.spanId,\n        timestamp: new Date().toISOString()\n    };\n    switch(level){\n        case 'info':\n            console.info('📊', logData);\n            break;\n        case 'warn':\n            console.warn('⚠️', logData);\n            break;\n        case 'error':\n            console.error('❌', logData);\n            break;\n        case 'debug':\n            console.debug('🔍', logData);\n            break;\n    }\n}\n// Utility function to create a correlation-aware fetch wrapper\nfunction createCorrelationAwareFetch() {\n    return async (input, init)=>{\n        const context = correlationManager.getContext();\n        if (context) {\n            const options = createFetchOptionsWithCorrelation(context.id, init);\n            // Log the request\n            logWithCorrelation('info', 'API Request', {\n                url: typeof input === 'string' ? input : input.toString(),\n                method: options.method || 'GET',\n                correlation_id: context.id\n            });\n            try {\n                const response = await fetch(input, options);\n                // Log the response\n                logWithCorrelation('info', 'API Response', {\n                    url: typeof input === 'string' ? input : input.toString(),\n                    status: response.status,\n                    statusText: response.statusText,\n                    correlation_id: context.id\n                });\n                return response;\n            } catch (error) {\n                // Log the error\n                logWithCorrelation('error', 'API Request Failed', {\n                    url: typeof input === 'string' ? input : input.toString(),\n                    error: error instanceof Error ? error.message : String(error),\n                    correlation_id: context.id\n                });\n                throw error;\n            }\n        }\n        // Fallback to regular fetch if no correlation context\n        return fetch(input, init);\n    };\n}\n// Export the correlation-aware fetch function\nconst correlationAwareFetch = createCorrelationAwareFetch();\n// Utility function to wrap async operations with correlation context\nfunction withCorrelationContext(operation, metadata = {}) {\n    const childContext = correlationManager.createChildContext(metadata);\n    correlationManager.setContext(childContext);\n    return operation().finally(()=>{\n        // Restore parent context if it exists\n        if (childContext.parentId) {\n            const parentContext = correlationManager.getContext();\n            if (parentContext && parentContext.id === childContext.parentId) {\n                correlationManager.setContext(parentContext);\n            }\n        }\n    });\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKG1pZGRsZXdhcmUpLy4vc3JjL2xpYi9jb3JyZWxhdGlvbi1pZC50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7O0FBQUEsK0RBQStEO0FBRS9ELGdCQUFnQjtBQUNoQixNQUFNQSx3QkFBd0JDLFFBQVFDLEdBQUcsQ0FBQ0MsaUNBQWlDLElBQUk7QUFDL0UsTUFBTUMsd0JBQXdCQyxTQUFTSixRQUFRQyxHQUFHLENBQUNJLGlDQUFpQyxJQUFJLE1BQU07QUFlOUYsbUNBQW1DO0FBQzVCLFNBQVNDO0lBQ2QsTUFBTUMsUUFBUTtJQUNkLElBQUlDLFNBQVM7SUFDYixJQUFLLElBQUlDLElBQUksR0FBR0EsSUFBSU4sdUJBQXVCTSxJQUFLO1FBQzlDRCxVQUFVRCxNQUFNRyxNQUFNLENBQUNDLEtBQUtDLEtBQUssQ0FBQ0QsS0FBS0UsTUFBTSxLQUFLTixNQUFNTyxNQUFNO0lBQ2hFO0lBQ0EsT0FBT047QUFDVDtBQUVBLHVEQUF1RDtBQUNoRCxTQUFTTztJQUNkLE9BQU9ULDBCQUEwQkE7QUFDbkM7QUFFQSxvRUFBb0U7QUFDN0QsU0FBU1U7SUFDZCxPQUFPVix3QkFBd0JXLFNBQVMsQ0FBQyxHQUFHO0FBQzlDO0FBRUEsbUNBQW1DO0FBQzVCLFNBQVNDLHlCQUNkQyxhQUEyQyxFQUMzQ0MsV0FBZ0MsQ0FBQyxDQUFDO0lBRWxDLE1BQU1DLE1BQU0sSUFBSUMsT0FBT0MsV0FBVztJQUVsQyxPQUFPO1FBQ0xDLElBQUlMLGVBQWVLLE1BQU1sQjtRQUN6Qm1CLFVBQVVOLGVBQWVNO1FBQ3pCQyxTQUFTUCxlQUFlTyxXQUFXWDtRQUNuQ1ksUUFBUVg7UUFDUlksUUFBUVQsZUFBZVM7UUFDdkJDLFdBQVdWLGVBQWVVO1FBQzFCQyxXQUFXWCxlQUFlVyxhQUFheEI7UUFDdkN5QixXQUFXVjtRQUNYRCxVQUFVO1lBQ1IsR0FBR0QsZUFBZUMsUUFBUTtZQUMxQixHQUFHQSxRQUFRO1lBQ1hZLFlBQVlYO1FBQ2Q7SUFDRjtBQUNGO0FBRUEsc0NBQXNDO0FBQy9CLFNB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QUMvQmQsZ0JBQWdCbkMsUUFBUXRCLEVBQUU7Z0JBQzVCO2dCQUVBLE9BQU9vRTtZQUNULEVBQUUsT0FBTy9CLE9BQU87Z0JBQ2QsZ0JBQWdCO2dCQUNoQmUsbUJBQW1CLFNBQVMsc0JBQXNCO29CQUNoRGMsS0FBSyxPQUFPRixVQUFVLFdBQVdBLFFBQVFBLE1BQU1uQixRQUFRO29CQUN2RFIsT0FBT0EsaUJBQWlCbUMsUUFBUW5DLE1BQU1pQixPQUFPLEdBQUdtQixPQUFPcEM7b0JBQ3ZEb0IsZ0JBQWdCbkMsUUFBUXRCLEVBQUU7Z0JBQzVCO2dCQUVBLE1BQU1xQztZQUNSO1FBQ0Y7UUFFQSxzREFBc0Q7UUFDdEQsT0FBT2dDLE1BQU1MLE9BQU9DO0lBQ3RCO0FBQ0Y7QUFFQSw4Q0FBOEM7QUFDdkMsTUFBTVMsd0JBQXdCWCw4QkFBNkI7QUFFbEUscUVBQXFFO0FBQzlELFNBQVNZLHVCQUNkQyxTQUEyQixFQUMzQmhGLFdBQWdDLENBQUMsQ0FBQztJQUVsQyxNQUFNaUYsZUFBZTFCLG1CQUFtQnpCLGtCQUFrQixDQUFDOUI7SUFDM0R1RCxtQkFBbUI5QixVQUFVLENBQUN3RDtJQUU5QixPQUFPRCxZQUFZRSxPQUFPLENBQUM7UUFDekIsc0NBQXNDO1FBQ3RDLElBQUlELGFBQWE1RSxRQUFRLEVBQUU7WUFDekIsTUFBTU4sZ0JBQWdCd0QsbUJBQW1CMUIsVUFBVTtZQUNuRCxJQUFJOUIsaUJBQWlCQSxjQUFjSyxFQUFFLEtBQUs2RSxhQUFhNUUsUUFBUSxFQUFFO2dCQUMvRGtELG1CQUFtQjlCLFVBQVUsQ0FBQzFCO1lBQ2hDO1FBQ0Y7SUFDRjtBQUNGIiwic291cmNlcyI6WyIvVXNlcnMvbWFjbWluaS9Eb2N1bWVudHMvUHJvamVjdHMvU2FhUyBGYWN0b3J5L3VpL25leHRqcy9zcmMvbGliL2NvcnJlbGF0aW9uLWlkLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcnJlbGF0aW9uIElEIHNlcnZpY2UgZm9yIHJlcXVlc3QgdHJhY2luZyBhbmQgb2JzZXJ2YWJpbGl0eVxuXG4vLyBDb25maWd1cmF0aW9uXG5jb25zdCBDT1JSRUxBVElPTl9JRF9IRUFERVIgPSBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19DT1JSRUxBVElPTl9JRF9IRUFERVIgfHwgJ1gtQ29ycmVsYXRpb24tSUQnXG5jb25zdCBDT1JSRUxBVElPTl9JRF9MRU5HVEggPSBwYXJzZUludChwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19DT1JSRUxBVElPTl9JRF9MRU5HVEggfHwgJzE2JywgMTApXG5cbi8vIENvcnJlbGF0aW9uIElEIGludGVyZmFjZVxuZXhwb3J0IGludGVyZmFjZSBDb3JyZWxhdGlvbkNvbnRleHQge1xuICBpZDogc3RyaW5nXG4gIHBhcmVudElkPzogc3RyaW5nXG4gIHRyYWNlSWQ/OiBzdHJpbmdcbiAgc3BhbklkPzogc3RyaW5nXG4gIHVzZXJJZD86IHN0cmluZ1xuICBzZXNzaW9uSWQ/OiBzdHJpbmdcbiAgcmVxdWVzdElkPzogc3RyaW5nXG4gIHRpbWVzdGFtcDogc3RyaW5nXG4gIG1ldGFkYXRhOiBSZWNvcmQ8c3RyaW5nLCBhbnk+XG59XG5cbi8vIEdlbmVyYXRlIGEgdW5pcXVlIGNvcnJlbGF0aW9uIElEXG5leHBvcnQgZnVuY3Rpb24gZ2VuZXJhdGVDb3JyZWxhdGlvbklkKCk6IHN0cmluZyB7XG4gIGNvbnN0IGNoYXJzID0gJ0FCQ0RFRkdISUpLTE1OT1BRUlNUVVZXWFlaYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXowMTIzNDU2Nzg5J1xuICBsZXQgcmVzdWx0ID0gJydcbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBDT1JSRUxBVElPTl9JRF9MRU5HVEg7IGkrKykge1xuICAgIHJlc3VsdCArPSBjaGFycy5jaGFyQXQoTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogY2hhcnMubGVuZ3RoKSlcbiAgfVxuICByZXR1cm4gcmVzdWx0XG59XG5cbi8vIEdlbmVyYXRlIGEgdHJhY2UgSUQgKGxvbmdlciwgbW9yZSB1bmlxdWUgaWRlbnRpZmllcilcbmV4cG9ydCBmdW5jdGlvbiBnZW5lcmF0ZVRyYWNlSWQoKTogc3RyaW5nIHtcbiAgcmV0dXJuIGdlbmVyYXRlQ29ycmVsYXRpb25JZCgpICsgZ2VuZXJhdGVDb3JyZWxhdGlvbklkKClcbn1cblxuLy8gR2VuZXJhdGUgYSBzcGFuIElEIChzaG9ydGVyIGlkZW50aWZpZXIgZm9yIGluZGl2aWR1YWwgb3BlcmF0aW9ucylcbmV4cG9ydCBmdW5jdGlvbiBnZW5lcmF0ZVNwYW5JZCgpOiBzdHJpbmcge1xuICByZXR1cm4gZ2VuZXJhdGVDb3JyZWxhdGlvbklkKCkuc3Vic3RyaW5nKDAsIDgpXG59XG5cbi8vIENyZWF0ZSBhIG5ldyBjb3JyZWxhdGlvbiBjb250ZXh0XG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlQ29ycmVsYXRpb25Db250ZXh0KFxuICBwYXJlbnRDb250ZXh0PzogUGFydGlhbDxDb3JyZWxhdGlvbkNvbnRleHQ+LFxuICBtZXRhZGF0YTogUmVjb3JkPHN0cmluZywgYW55PiA9IHt9XG4pOiBDb3JyZWxhdGlvbkNvbnRleHQge1xuICBjb25zdCBub3cgPSBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKClcbiAgXG4gIHJldHVybiB7XG4gICAgaWQ6IHBhcmVudENvbnRleHQ/LmlkIHx8IGdlbmVyYXRlQ29ycmVsYXRpb25JZCgpLFxuICAgIHBhcmVudElkOiBwYXJlbnRDb250ZXh0Py5wYXJlbnRJZCxcbiAgICB0cmFjZUlkOiBwYXJlbnRDb250ZXh0Py50cmFjZUlkIHx8IGdlbmVyYXRlVHJhY2VJZCgpLFxuICAgIHNwYW5JZDogZ2VuZXJhdGVTcGFuSWQoKSxcbiAgICB1c2VySWQ6IHBhcmVudENvbnRleHQ/LnVzZXJJZCxcbiAgICBzZXNzaW9uSWQ6IHBhcmVudENvbnRleHQ/LnNlc3Npb25JZCxcbiAgICByZXF1ZXN0SWQ6IHBhcmVudENvbnRleHQ/LnJlcXVlc3RJZCB8fCBnZW5lcmF0ZUNvcnJlbGF0aW9uSWQoKSxcbiAgICB0aW1lc3RhbXA6IG5vdyxcbiAgICBtZXRhZGF0YToge1xuICAgICAgLi4ucGFyZW50Q29udGV4dD8ubWV0YWRhdGEsXG4gICAgICAuLi5tZXRhZGF0YSxcbiAgICAgIGNyZWF0ZWRfYXQ6IG5vdyxcbiAgICB9LFxuICB9XG59XG5cbi8vIEV4dHJhY3QgY29ycmVsYXRpb24gSUQgZnJvbSBoZWFkZXJzXG5leHBvcnQgZnVuY3Rpb24gZXh0cmFjdENvcnJlbGF0aW9uSWQoaGVhZGVyczogSGVhZGVycyB8IFJlY29yZDxzdHJpbmcsIHN0cmluZz4pOiBzdHJpbmcgfCBudWxsIHtcbiAgaWYgKGhlYWRlcnMgaW5zdGFuY2VvZiBIZWFkZXJzKSB7XG4gICAgcmV0dXJuIGhlYWRlcnMuZ2V0KENPUlJFTEFUSU9OX0lEX0hFQURFUikgfHwgbnVsbFxuICB9XG4gIHJldHVybiBoZWFkZXJzW0NPUlJFTEFUSU9OX0lEX0hFQURFUl0gfHwgbnVsbFxufVxuXG4vLyBBZGQgY29ycmVsYXRpb24gSUQgdG8gaGVhZGVyc1xuZXhwb3J0IGZ1bmN0aW9uIGFkZENvcnJlbGF0aW9uSWQoXG4gIGhlYWRlcnM6IEhlYWRlcnMgfCBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+LFxuICBjb3JyZWxhdGlvbklkOiBzdHJpbmdcbik6IHZvaWQge1xuICBpZiAoaGVhZGVycyBpbnN0YW5jZW9mIEhlYWRlcnMpIHtcbiAgICBoZWFkZXJzLnNldChDT1JSRUxBVElPTl9JRF9IRUFERVIsIGNvcnJlbGF0aW9uSWQpXG4gIH0gZWxzZSB7XG4gICAgaGVhZGVyc1tDT1JSRUxBVElPTl9JRF9IRUFERVJdID0gY29ycmVsYXRpb25JZFxuICB9XG59XG5cbi8vIENyZWF0ZSBoZWFkZXJzIHdpdGggY29ycmVsYXRpb24gSURcbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVIZWFkZXJzV2l0aENvcnJlbGF0aW9uKFxuICBjb3JyZWxhdGlvbklkOiBzdHJpbmcsXG4gIGFkZGl0aW9uYWxIZWFkZXJzOiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+ID0ge31cbik6IFJlY29yZDxzdHJpbmcsIHN0cmluZz4ge1xuICByZXR1cm4ge1xuICAgIFtDT1JSRUxBVElPTl9JRF9IRUFERVJdOiBjb3JyZWxhdGlvbklkLFxuICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicsXG4gICAgLi4uYWRkaXRpb25hbEhlYWRlcnMsXG4gIH1cbn1cblxuLy8gQ3JlYXRlIGZldGNoIG9wdGlvbnMgd2l0aCBjb3JyZWxhdGlvbiBJRFxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZUZldGNoT3B0aW9uc1dpdGhDb3JyZWxhdGlvbihcbiAgY29ycmVsYXRpb25JZDogc3RyaW5nLFxuICBvcHRpb25zOiBSZXF1ZXN0SW5pdCA9IHt9XG4pOiBSZXF1ZXN0SW5pdCB7XG4gIHJldHVybiB7XG4gICAgLi4ub3B0aW9ucyxcbiAgICBoZWFkZXJzOiB7XG4gICAgICAuLi5jcmVhdGVIZWFkZXJzV2l0aENvcnJlbGF0aW9uKGNvcnJlbGF0aW9uSWQpLFxuICAgICAgLi4ub3B0aW9ucy5oZWFkZXJzLFxuICAgIH0sXG4gIH1cbn1cblxuLy8gQ29ycmVsYXRpb24gY29udGV4dCBtYW5hZ2VyIGZvciBSZWFjdCBjb21wb25lbnRzXG5jbGFzcyBDb3JyZWxhdGlvbkNvbnRleHRNYW5hZ2VyIHtcbiAgcHJpdmF0ZSBjdXJyZW50Q29udGV4dDogQ29ycmVsYXRpb25Db250ZXh0IHwgbnVsbCA9IG51bGxcbiAgcHJpdmF0ZSBsaXN0ZW5lcnM6IFNldDwoY29udGV4dDogQ29ycmVsYXRpb25Db250ZXh0IHwgbnVsbCkgPT4gdm9pZD4gPSBuZXcgU2V0KClcblxuICAvLyBTZXQgdGhlIGN1cnJlbnQgY29ycmVsYXRpb24gY29udGV4dFxuICBzZXRDb250ZXh0KGNvbnRleHQ6IENvcnJlbGF0aW9uQ29udGV4dCk6IHZvaWQge1xuICAgIHRoaXMuY3VycmVudENvbnRleHQgPSBjb250ZXh0XG4gICAgdGhpcy5ub3RpZnlMaXN0ZW5lcnMoKVxuICB9XG5cbiAgLy8gR2V0IHRoZSBjdXJyZW50IGNvcnJlbGF0aW9uIGNvbnRleHRcbiAgZ2V0Q29udGV4dCgpOiBDb3JyZWxhdGlvbkNvbnRleHQgfCBudWxsIHtcbiAgICByZXR1cm4gdGhpcy5jdXJyZW50Q29udGV4dFxuICB9XG5cbiAgLy8gQ3JlYXRlIGEgY2hpbGQgY29udGV4dFxuICBjcmVhdGVDaGlsZENvbnRleHQobWV0YWRhdGE6IFJlY29yZDxzdHJpbmcsIGFueT4gPSB7fSk6IENvcnJlbGF0aW9uQ29udGV4dCB7XG4gICAgaWYgKCF0aGlzLmN1cnJlbnRDb250ZXh0KSB7XG4gICAgICByZXR1cm4gY3JlYXRlQ29ycmVsYXRpb25Db250ZXh0KHt9LCBtZXRhZGF0YSlcbiAgICB9XG4gICAgXG4gICAgcmV0dXJuIGNyZWF0ZUNvcnJlbGF0aW9uQ29udGV4dCh0aGlzLmN1cnJlbnRDb250ZXh0LCB7XG4gICAgICAuLi5tZXRhZGF0YSxcbiAgICAgIHBhcmVudF9jb3JyZWxhdGlvbl9pZDogdGhpcy5jdXJyZW50Q29udGV4dC5pZCxcbiAgICB9KVxuICB9XG5cbiAgLy8gVXBkYXRlIHRoZSBjdXJyZW50IGNvbnRleHQgd2l0aCBhZGRpdGlvbmFsIG1ldGFkYXRhXG4gIHVwZGF0ZUNvbnRleHQobWV0YWRhdGE6IFJlY29yZDxzdHJpbmcsIGFueT4pOiB2b2lkIHtcbiAgICBpZiAodGhpcy5jdXJyZW50Q29udGV4dCkge1xuICAgICAgdGhpcy5jdXJyZW50Q29udGV4dC5tZXRhZGF0YSA9IHtcbiAgICAgICAgLi4udGhpcy5jdXJyZW50Q29udGV4dC5tZXRhZGF0YSxcbiAgICAgICAgLi4ubWV0YWRhdGEsXG4gICAgICAgIHVwZGF0ZWRfYXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgIH1cbiAgICAgIHRoaXMubm90aWZ5TGlzdGVuZXJzKClcbiAgICB9XG4gIH1cblxuICAvLyBDbGVhciB0aGUgY3VycmVudCBjb250ZXh0XG4gIGNsZWFyQ29udGV4dCgpOiB2b2lkIHtcbiAgICB0aGlzLmN1cnJlbnRDb250ZXh0ID0gbnVsbFxuICAgIHRoaXMubm90aWZ5TGlzdGVuZXJzKClcbiAgfVxuXG4gIC8vIFN1YnNjcmliZSB0byBjb250ZXh0IGNoYW5nZXNcbiAgc3Vic2NyaWJlKGxpc3RlbmVyOiAoY29udGV4dDogQ29ycmVsYXRpb25Db250ZXh0IHwgbnVsbCkgPT4gdm9pZCk6ICgpID0+IHZvaWQge1xuICAgIHRoaXMubGlzdGVuZXJzLmFkZChsaXN0ZW5lcilcbiAgICByZXR1cm4gKCkgPT4ge1xuICAgICAgdGhpcy5saXN0ZW5lcnMuZGVsZXRlKGxpc3RlbmVyKVxuICAgIH1cbiAgfVxuXG4gIC8vIE5vdGlmeSBhbGwgbGlzdGVuZXJzIG9mIGNvbnRleHQgY2hhbmdlc1xuICBwcml2YXRlIG5vdGlmeUxpc3RlbmVycygpOiB2b2lkIHtcbiAgICB0aGlzLmxpc3RlbmVycy5mb3JFYWNoKGxpc3RlbmVyID0+IHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGxpc3RlbmVyKHRoaXMuY3VycmVudENvbnRleHQpXG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBpbiBjb3JyZWxhdGlvbiBjb250ZXh0IGxpc3RlbmVyOicsIGVycm9yKVxuICAgICAgfVxuICAgIH0pXG4gIH1cblxuICAvLyBFeHRyYWN0IGNvcnJlbGF0aW9uIElEIGZyb20gaGVhZGVyc1xuICBleHRyYWN0RnJvbUhlYWRlcnMoaGVhZGVyczogUmVjb3JkPHN0cmluZywgc3RyaW5nPik6IENvcnJlbGF0aW9uQ29udGV4dCB8IG51bGwge1xuICAgIGNvbnN0IGNvcnJlbGF0aW9uSWQgPSBoZWFkZXJzWyd4LWNvcnJlbGF0aW9uLWlkJ10gfHwgaGVhZGVyc1snWC1Db3JyZWxhdGlvbi1JRCddXG4gICAgaWYgKCFjb3JyZWxhdGlvbklkKSByZXR1cm4gbnVsbFxuXG4gICAgY29uc3QgY29udGV4dCA9IHRoaXMuZ2V0Q29udGV4dChjb3JyZWxhdGlvbklkKVxuICAgIGlmIChjb250ZXh0KSB7XG4gICAgICB0aGlzLnNldEN1cnJlbnRDb250ZXh0KGNvbnRleHQpXG4gICAgICByZXR1cm4gY29udGV4dFxuICAgIH1cblxuICAgIC8vIENyZWF0ZSBuZXcgY29udGV4dCBmcm9tIGhlYWRlcnMsIHByZXNlcnZpbmcgdGhlIGluY29taW5nIGNvcnJlbGF0aW9uIElEXG4gICAgY29uc3QgbmV3Q29udGV4dDogQ29ycmVsYXRpb25Db250ZXh0ID0ge1xuICAgICAgY29ycmVsYXRpb25JZDogY29ycmVsYXRpb25JZCwgLy8gVXNlIHRoZSBpbmNvbWluZyBjb3JyZWxhdGlvbiBJRFxuICAgICAgcmVxdWVzdElkOiBoZWFkZXJzWyd4LXJlcXVlc3QtaWQnXSB8fCBoZWFkZXJzWydYLVJlcXVlc3QtSUQnXSB8fCB1dWlkdjQoKSxcbiAgICAgIHBhcmVudElkOiBoZWFkZXJzWyd4LXBhcmVudC1pZCddIHx8IGhlYWRlcnNbJ1gtUGFyZW50LUlEJ10gfHwgdW5kZWZpbmVkLFxuICAgICAgc3BhbklkOiBoZWFkZXJzWyd4LXNwYW4taWQnXSB8fCBoZWFkZXJzWydYLVNwYW4tSUQnXSB8fCB1dWlkdjQoKSxcbiAgICAgIHRyYWNlSWQ6IGhlYWRlcnNbJ3gtdHJhY2UtaWQnXSB8fCBoZWFkZXJzWydYLVRyYWNlLUlEJ10gfHwgY29ycmVsYXRpb25JZCxcbiAgICAgIHVzZXJJZDogaGVhZGVyc1sneC11c2VyLWlkJ10gfHwgaGVhZGVyc1snWC1Vc2VyLUlEJ10gfHwgdW5kZWZpbmVkLFxuICAgICAgdGVuYW50SWQ6IGhlYWRlcnNbJ3gtdGVuYW50LWlkJ10gfHwgaGVhZGVyc1snWC1UZW5hbnQtSUQnXSB8fCB1bmRlZmluZWQsXG4gICAgICBzZXNzaW9uSWQ6IGhlYWRlcnNbJ3gtc2Vzc2lvbi1pZCddIHx8IGhlYWRlcnNbJ1gtU2Vzc2lvbi1JRCddIHx8IHVuZGVmaW5lZCxcbiAgICAgIHRpbWVzdGFtcDogcGFyc2VJbnQoaGVhZGVyc1sneC10aW1lc3RhbXAnXSB8fCBoZWFkZXJzWydYLVRpbWVzdGFtcCddIHx8IERhdGUubm93KCkudG9TdHJpbmcoKSksXG4gICAgICBtZXRhZGF0YToge1xuICAgICAgICBzZXJ2aWNlOiBoZWFkZXJzWyd4LXNlcnZpY2UnXSB8fCBoZWFkZXJzWydYLVNlcnZpY2UnXSB8fCAndW5rbm93bicsXG4gICAgICAgIHZlcnNpb246IHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX0FQUF9WRVJTSU9OIHx8ICcxLjAuMCcsXG4gICAgICAgIGVudmlyb25tZW50OiBwcm9jZXNzLmVudi5OT0RFX0VOViB8fCAnZGV2ZWxvcG1lbnQnXG4gICAgICB9XG4gICAgfVxuXG4gICAgdGhpcy5zZXRDdXJyZW50Q29udGV4dChuZXdDb250ZXh0KVxuICAgIHJldHVybiBuZXdDb250ZXh0XG4gIH1cbn1cblxuLy8gRXhwb3J0IHNpbmdsZXRvbiBpbnN0YW5jZVxuZXhwb3J0IGNvbnN0IGNvcnJlbGF0aW9uTWFuYWdlciA9IG5ldyBDb3JyZWxhdGlvbkNvbnRleHRNYW5hZ2VyKClcblxuLy8gVXRpbGl0eSBmdW5jdGlvbiB0byBsb2cgd2l0aCBjb3JyZWxhdGlvbiBjb250ZXh0XG5leHBvcnQgZnVuY3Rpb24gbG9nV2l0aENvcnJlbGF0aW9uKFxuICBsZXZlbDogJ2luZm8nIHwgJ3dhcm4nIHwgJ2Vycm9yJyB8ICdkZWJ1ZycsXG4gIG1lc3NhZ2U6IHN0cmluZyxcbiAgZGF0YT86IGFueVxuKTogdm9pZCB7XG4gIGNvbnN0IGNvbnRleHQgPSBjb3JyZWxhdGlvbk1hbmFnZXIuZ2V0Q29udGV4dCgpXG4gIGNvbnN0IGxvZ0RhdGEgPSB7XG4gICAgbWVzc2FnZSxcbiAgICBkYXRhLFxuICAgIGNvcnJlbGF0aW9uX2lkOiBjb250ZXh0Py5pZCxcbiAgICB0cmFjZV9pZDogY29udGV4dD8udHJhY2VJZCxcbiAgICBzcGFuX2lkOiBjb250ZXh0Py5zcGFuSWQsXG4gICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gIH1cblxuICBzd2l0Y2ggKGxldmVsKSB7XG4gICAgY2FzZSAnaW5mbyc6XG4gICAgICBjb25zb2xlLmluZm8oJ/Cfk4onLCBsb2dEYXRhKVxuICAgICAgYnJlYWtcbiAgICBjYXNlICd3YXJuJzpcbiAgICAgIGNvbnNvbGUud2Fybign4pqg77iPJywgbG9nRGF0YSlcbiAgICAgIGJyZWFrXG4gICAgY2FzZSAnZXJyb3InOlxuICAgICAgY29uc29sZS5lcnJvcign4p2MJywgbG9nRGF0YSlcbiAgICAgIGJyZWFrXG4gICAgY2FzZSAnZGVidWcnOlxuICAgICAgY29uc29sZS5kZWJ1Zygn8J+UjScsIGxvZ0RhdGEpXG4gICAgICBicmVha1xuICB9XG59XG5cbi8vIFV0aWxpdHkgZnVuY3Rpb24gdG8gY3JlYXRlIGEgY29ycmVsYXRpb24tYXdhcmUgZmV0Y2ggd3JhcHBlclxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZUNvcnJlbGF0aW9uQXdhcmVGZXRjaCgpOiB0eXBlb2YgZmV0Y2gge1xuICByZXR1cm4gYXN5bmMgKGlucHV0OiBSZXF1ZXN0SW5mbyB8IFVSTCwgaW5pdD86IFJlcXVlc3RJbml0KTogUHJvbWlzZTxSZXNwb25zZT4gPT4ge1xuICAgIGNvbnN0IGNvbnRleHQgPSBjb3JyZWxhdGlvbk1hbmFnZXIuZ2V0Q29udGV4dCgpXG4gICAgXG4gICAgaWYgKGNvbnRleHQpIHtcbiAgICAgIGNvbnN0IG9wdGlvbnMgPSBjcmVhdGVGZXRjaE9wdGlvbnNXaXRoQ29ycmVsYXRpb24oY29udGV4dC5pZCwgaW5pdClcbiAgICAgIFxuICAgICAgLy8gTG9nIHRoZSByZXF1ZXN0XG4gICAgICBsb2dXaXRoQ29ycmVsYXRpb24oJ2luZm8nLCAnQVBJIFJlcXVlc3QnLCB7XG4gICAgICAgIHVybDogdHlwZW9mIGlucHV0ID09PSAnc3RyaW5nJyA/IGlucHV0IDogaW5wdXQudG9TdHJpbmcoKSxcbiAgICAgICAgbWV0aG9kOiBvcHRpb25zLm1ldGhvZCB8fCAnR0VUJyxcbiAgICAgICAgY29ycmVsYXRpb25faWQ6IGNvbnRleHQuaWQsXG4gICAgICB9KVxuICAgICAgXG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKGlucHV0LCBvcHRpb25zKVxuICAgICAgICBcbiAgICAgICAgLy8gTG9nIHRoZSByZXNwb25zZVxuICAgICAgICBsb2dXaXRoQ29ycmVsYXRpb24oJ2luZm8nLCAnQVBJIFJlc3BvbnNlJywge1xuICAgICAgICAgIHVybDogdHlwZW9mIGlucHV0ID09PSAnc3RyaW5nJyA/IGlucHV0IDogaW5wdXQudG9TdHJpbmcoKSxcbiAgICAgICAgICBzdGF0dXM6IHJlc3BvbnNlLnN0YXR1cyxcbiAgICAgICAgICBzdGF0dXNUZXh0OiByZXNwb25zZS5zdGF0dXNUZXh0LFxuICAgICAgICAgIGNvcnJlbGF0aW9uX2lkOiBjb250ZXh0LmlkLFxuICAgICAgICB9KVxuICAgICAgICBcbiAgICAgICAgcmV0dXJuIHJlc3BvbnNlXG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAvLyBMb2cgdGhlIGVycm9yXG4gICAgICAgIGxvZ1dpdGhDb3JyZWxhdGlvbignZXJyb3InLCAnQVBJIFJlcXVlc3QgRmFpbGVkJywge1xuICAgICAgICAgIHVybDogdHlwZW9mIGlucHV0ID09PSAnc3RyaW5nJyA/IGlucHV0IDogaW5wdXQudG9TdHJpbmcoKSxcbiAgICAgICAgICBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiBTdHJpbmcoZXJyb3IpLFxuICAgICAgICAgIGNvcnJlbGF0aW9uX2lkOiBjb250ZXh0LmlkLFxuICAgICAgICB9KVxuICAgICAgICBcbiAgICAgICAgdGhyb3cgZXJyb3JcbiAgICAgIH1cbiAgICB9XG4gICAgXG4gICAgLy8gRmFsbGJhY2sgdG8gcmVndWxhciBmZXRjaCBpZiBubyBjb3JyZWxhdGlvbiBjb250ZXh0XG4gICAgcmV0dXJuIGZldGNoKGlucHV0LCBpbml0KVxuICB9XG59XG5cbi8vIEV4cG9ydCB0aGUgY29ycmVsYXRpb24tYXdhcmUgZmV0Y2ggZnVuY3Rpb25cbmV4cG9ydCBjb25zdCBjb3JyZWxhdGlvbkF3YXJlRmV0Y2ggPSBjcmVhdGVDb3JyZWxhdGlvbkF3YXJlRmV0Y2goKVxuXG4vLyBVdGlsaXR5IGZ1bmN0aW9uIHRvIHdyYXAgYXN5bmMgb3BlcmF0aW9ucyB3aXRoIGNvcnJlbGF0aW9uIGNvbnRleHRcbmV4cG9ydCBmdW5jdGlvbiB3aXRoQ29ycmVsYXRpb25Db250ZXh0PFQ+KFxuICBvcGVyYXRpb246ICgpID0+IFByb21pc2U8VD4sXG4gIG1ldGFkYXRhOiBSZWNvcmQ8c3RyaW5nLCBhbnk+ID0ge31cbik6IFByb21pc2U8VD4ge1xuICBjb25zdCBjaGlsZENvbnRleHQgPSBjb3JyZWxhdGlvbk1hbmFnZXIuY3JlYXRlQ2hpbGRDb250ZXh0KG1ldGFkYXRhKVxuICBjb3JyZWxhdGlvbk1hbmFnZXIuc2V0Q29udGV4dChjaGlsZENvbnRleHQpXG4gIFxuICByZXR1cm4gb3BlcmF0aW9uKCkuZmluYWxseSgoKSA9PiB7XG4gICAgLy8gUmVzdG9yZSBwYXJlbnQgY29udGV4dCBpZiBpdCBleGlzdHNcbiAgICBpZiAoY2hpbGRDb250ZXh0LnBhcmVudElkKSB7XG4gICAgICBjb25zdCBwYXJlbnRDb250ZXh0ID0gY29ycmVsYXRpb25NYW5hZ2VyLmdldENvbnRleHQoKVxuICAgICAgaWYgKHBhcmVudENvbnRleHQgJiYgcGFyZW50Q29udGV4dC5pZCA9PT0gY2hpbGRDb250ZXh0LnBhcmVudElkKSB7XG4gICAgICAgIGNvcnJlbGF0aW9uTWFuYWdlci5zZXRDb250ZXh0KHBhcmVudENvbnRleHQpXG4gICAgICB9XG4gICAgfVxuICB9KVxufVxuXG4vLyBFeHBvcnQgdHlwZXMgZm9yIGV4dGVybmFsIHVzZVxuZXhwb3J0IHR5cGUgeyBDb3JyZWxhdGlvbkNvbnRleHQgfVxuIl0sIm5hbWVzIjpbIkNPUlJFTEFUSU9OX0lEX0hFQURFUiIsInByb2Nlc3MiLCJlbnYiLCJORVhUX1BVQkxJQ19DT1JSRUxBVElPTl9JRF9IRUFERVIiLCJDT1JSRUxBVElPTl9JRF9MRU5HVEgiLCJwYXJzZUludCIsIk5FWFRfUFVCTElDX0NPUlJFTEFUSU9OX0lEX0xFTkdUSCIsImdlbmVyYXRlQ29ycmVsYXRpb25JZCIsImNoYXJzIiwicmVzdWx0IiwiaSIsImNoYXJBdCIsIk1hdGgiLCJmbG9vciIsInJhbmRvbSIsImxlbmd0aCIsImdlbmVyYXRlVHJhY2VJZCIsImdlbmVyYXRlU3BhbklkIiwic3Vic3RyaW5nIiwiY3JlYXRlQ29ycmVsYXRpb25Db250ZXh0IiwicGFyZW50Q29udGV4dCIsIm1ldGFkYXRhIiwibm93IiwiRGF0ZSIsInRvSVNPU3RyaW5nIiwiaWQiLCJwYXJlbnRJZCIsInRyYWNlSWQiLCJzcGFuSWQiLCJ1c2VySWQiLCJzZXNzaW9uSWQiLCJyZXF1ZXN0SWQiLCJ0aW1lc3RhbXAiLCJjcmVhdGVkX2F0IiwiZXh0cmFjdENvcnJlbGF0aW9uSWQiLCJoZWFkZXJzIiwiSGVhZGVycyIsImdldCIsImFkZENvcnJlbGF0aW9uSWQiLCJjb3JyZWxhdGlvbklkIiwic2V0IiwiY3JlYXRlSGVhZGVyc1dpdGhDb3JyZWxhdGlvbiIsImFkZGl0aW9uYWxIZWFkZXJzIiwiY3JlYXRlRmV0Y2hPcHRpb25zV2l0aENvcnJlbGF0aW9uIiwib3B0aW9ucyIsIkNvcnJlbGF0aW9uQ29udGV4dE1hbmFnZXIiLCJzZXRDb250ZXh0IiwiY29udGV4dCIsImN1cnJlbnRDb250ZXh0Iiwibm90aWZ5TGlzdGVuZXJzIiwiZ2V0Q29udGV4dCIsImNyZWF0ZUNoaWxkQ29udGV4dCIsInBhcmVudF9jb3JyZWxhdGlvbl9pZCIsInVwZGF0ZUNvbnRleHQiLCJ1cGRhdGVkX2F0IiwiY2xlYXJDb250ZXh0Iiwic3Vic2NyaWJlIiwibGlzdGVuZXIiLCJsaXN0ZW5lcnMiLCJhZGQiLCJkZWxldGUiLCJmb3JFYWNoIiwiZXJyb3IiLCJjb25zb2xlIiwiZXh0cmFjdEZyb21IZWFkZXJzIiwic2V0Q3VycmVudENvbnRleHQiLCJuZXdDb250ZXh0IiwidXVpZHY0IiwidW5kZWZpbmVkIiwidGVuYW50SWQiLCJ0b1N0cmluZyIsInNlcnZpY2UiLCJ2ZXJzaW9uIiwiTkVYVF9QVUJMSUNfQVBQX1ZFUlNJT04iLCJlbnZpcm9ubWVudCIsIlNldCIsImNvcnJlbGF0aW9uTWFuYWdlciIsImxvZ1dpdGhDb3JyZWxhdGlvbiIsImxldmVsIiwibWVzc2FnZSIsImRhdGEiLCJsb2dEYXRhIiwiY29ycmVsYXRpb25faWQiLCJ0cmFjZV9pZCIsInNwYW5faWQiLCJpbmZvIiwid2FybiIsImRlYnVnIiwiY3JlYXRlQ29ycmVsYXRpb25Bd2FyZUZldGNoIiwiaW5wdXQiLCJpbml0IiwidXJsIiwibWV0aG9kIiwicmVzcG9uc2UiLCJmZXRjaCIsInN0YXR1cyIsInN0YXR1c1RleHQiLCJFcnJvciIsIlN0cmluZyIsImNvcnJlbGF0aW9uQXdhcmVGZXRjaCIsIndpdGhDb3JyZWxhdGlvbkNvbnRleHQiLCJvcGVyYXRpb24iLCJjaGlsZENvbnRleHQiLCJmaW5hbGx5Il0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(middleware)/./src/lib/correlation-id.ts\n");

/***/ }),

/***/ "(middleware)/./src/middleware.ts":
/*!***************************!*\
  !*** ./src/middleware.ts ***!
  \***************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   middleware: () => (/* binding */ middleware)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(middleware)/./node_modules/next/dist/esm/api/server.js\");\n/* harmony import */ var _lib_correlation_id__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./lib/correlation-id */ \"(middleware)/./src/lib/correlation-id.ts\");\n\n\nfunction middleware(request) {\n    // Extract correlation ID from incoming request headers\n    const headers = Object.fromEntries(request.headers.entries());\n    const correlationContext = _lib_correlation_id__WEBPACK_IMPORTED_MODULE_1__.correlationIDManager.extractFromHeaders(headers);\n    // If no correlation context exists, create one\n    if (!correlationContext) {\n        _lib_correlation_id__WEBPACK_IMPORTED_MODULE_1__.correlationIDManager.generateContext(undefined, undefined, undefined, undefined, {\n            operation: 'http_request',\n            path: request.nextUrl.pathname,\n            method: request.method,\n            userAgent: headers['user-agent'],\n            referer: headers['referer']\n        });\n    }\n    // Clone the request headers to add correlation IDs\n    const requestHeaders = new Headers(request.headers);\n    const correlationHeaders = _lib_correlation_id__WEBPACK_IMPORTED_MODULE_1__.correlationIDManager.getHeaders();\n    // Add correlation headers to the request\n    Object.entries(correlationHeaders).forEach(([key, value])=>{\n        if (value) {\n            requestHeaders.set(key, value);\n        }\n    });\n    // Create a new request with correlation headers\n    const enhancedRequest = new next_server__WEBPACK_IMPORTED_MODULE_0__.NextRequest(request, {\n        headers: requestHeaders\n    });\n    // Process the request\n    const response = next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.next({\n        request: enhancedRequest\n    });\n    // Add correlation headers to the response\n    Object.entries(correlationHeaders).forEach(([key, value])=>{\n        if (value) {\n            response.headers.set(key, value);\n        }\n    });\n    // Add additional response headers for tracking\n    response.headers.set('X-Request-ID', _lib_correlation_id__WEBPACK_IMPORTED_MODULE_1__.correlationIDManager.getCurrentContext()?.requestId || '');\n    response.headers.set('X-Span-ID', _lib_correlation_id__WEBPACK_IMPORTED_MODULE_1__.correlationIDManager.getCurrentContext()?.spanId || '');\n    response.headers.set('X-Trace-ID', _lib_correlation_id__WEBPACK_IMPORTED_MODULE_1__.correlationIDManager.getCurrentContext()?.traceId || '');\n    // Log the request with correlation context\n    const currentContext = _lib_correlation_id__WEBPACK_IMPORTED_MODULE_1__.correlationIDManager.getCurrentContext();\n    if (currentContext) {\n        // Only log for non-asset requests to avoid noise\n        if (!request.nextUrl.pathname.startsWith('/_next/') && !request.nextUrl.pathname.startsWith('/favicon.ico') && !request.nextUrl.pathname.startsWith('/api/health')) {\n            _lib_correlation_id__WEBPACK_IMPORTED_MODULE_1__.correlationIDManager.logContext(currentContext, 'info');\n        }\n    }\n    return response;\n}\nconst config = {\n    matcher: [\n        /*\n     * Match all request paths except for the ones starting with:\n     * - api (API routes)\n     * - _next/static (static files)\n     * - _next/image (image optimization files)\n     * - favicon.ico (favicon file)\n     */ '/((?!api|_next/static|_next/image|favicon.ico).*)'\n    ]\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKG1pZGRsZXdhcmUpLy4vc3JjL21pZGRsZXdhcmUudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUF1RDtBQUNJO0FBRXBELFNBQVNHLFdBQVdDLE9BQW9CO0lBQzdDLHVEQUF1RDtJQUN2RCxNQUFNQyxVQUFVQyxPQUFPQyxXQUFXLENBQUNILFFBQVFDLE9BQU8sQ0FBQ0csT0FBTztJQUMxRCxNQUFNQyxxQkFBcUJQLHdGQUF1QyxDQUFDRztJQUVuRSwrQ0FBK0M7SUFDL0MsSUFBSSxDQUFDSSxvQkFBb0I7UUFDdkJQLHFGQUFvQyxDQUNsQ1UsV0FDQUEsV0FDQUEsV0FDQUEsV0FDQTtZQUNFQyxXQUFXO1lBQ1hDLE1BQU1WLFFBQVFXLE9BQU8sQ0FBQ0MsUUFBUTtZQUM5QkMsUUFBUWIsUUFBUWEsTUFBTTtZQUN0QkMsV0FBV2IsT0FBTyxDQUFDLGFBQWE7WUFDaENjLFNBQVNkLE9BQU8sQ0FBQyxVQUFVO1FBQzdCO0lBRUo7SUFFQSxtREFBbUQ7SUFDbkQsTUFBTWUsaUJBQWlCLElBQUlDLFFBQVFqQixRQUFRQyxPQUFPO0lBQ2xELE1BQU1pQixxQkFBcUJwQixnRkFBK0I7SUFFMUQseUNBQXlDO0lBQ3pDSSxPQUFPRSxPQUFPLENBQUNjLG9CQUFvQkUsT0FBTyxDQUFDLENBQUMsQ0FBQ0MsS0FBS0MsTUFBTTtRQUN0RCxJQUFJQSxPQUFPO1lBQ1ROLGVBQWVPLEdBQUcsQ0FBQ0YsS0FBS0M7UUFDMUI7SUFDRjtJQUVBLGdEQUFnRDtJQUNoRCxNQUFNRSxrQkFBa0IsSUFBSTVCLG9EQUFXQSxDQUFDSSxTQUFTO1FBQy9DQyxTQUFTZTtJQUNYO0lBRUEsc0JBQXNCO0lBQ3RCLE1BQU1TLFdBQVc1QixxREFBWUEsQ0FBQzZCLElBQUksQ0FBQztRQUNqQzFCLFNBQVN3QjtJQUNYO0lBRUEsMENBQTBDO0lBQzFDdEIsT0FBT0UsT0FBTyxDQUFDYyxvQkFBb0JFLE9BQU8sQ0FBQyxDQUFDLENBQUNDLEtBQUtDLE1BQU07UUFDdEQsSUFBSUEsT0FBTztZQUNURyxTQUFTeEIsT0FBTyxDQUFDc0IsR0FBRyxDQUFDRixLQUFLQztRQUM1QjtJQUNGO0lBRUEsK0NBQStDO0lBQy9DRyxTQUFTeEIsT0FBTyxDQUFDc0IsR0FBRyxDQUFDLGdCQUFnQnpCLHVGQUFzQyxJQUFJOEIsYUFBYTtJQUM1RkgsU0FBU3hCLE9BQU8sQ0FBQ3NCLEdBQUcsQ0FBQyxhQUFhekIsdUZBQXNDLElBQUkrQixVQUFVO0lBQ3RGSixTQUFTeEIsT0FBTyxDQUFDc0IsR0FBRyxDQUFDLGNBQWN6Qix1RkFBc0MsSUFBSWdDLFdBQVc7SUFFeEYsMkNBQTJDO0lBQzNDLE1BQU1DLGlCQUFpQmpDLHVGQUFzQztJQUM3RCxJQUFJaUMsZ0JBQWdCO1FBQ2xCLGlEQUFpRDtRQUNqRCxJQUFJLENBQUMvQixRQUFRVyxPQUFPLENBQUNDLFFBQVEsQ0FBQ29CLFVBQVUsQ0FBQyxjQUNyQyxDQUFDaEMsUUFBUVcsT0FBTyxDQUFDQyxRQUFRLENBQUNvQixVQUFVLENBQUMsbUJBQ3JDLENBQUNoQyxRQUFRVyxPQUFPLENBQUNDLFFBQVEsQ0FBQ29CLFVBQVUsQ0FBQyxnQkFBZ0I7WUFDdkRsQyxnRkFBK0IsQ0FBQ2lDLGdCQUFnQjtRQUNsRDtJQUNGO0lBRUEsT0FBT047QUFDVDtBQUVPLE1BQU1TLFNBQVM7SUFDcEJDLFNBQVM7UUFDUDs7Ozs7O0tBTUMsR0FDRDtLQUNEO0FBQ0gsRUFBQyIsInNvdXJjZXMiOlsiL1VzZXJzL21hY21pbmkvRG9jdW1lbnRzL1Byb2plY3RzL1NhYVMgRmFjdG9yeS91aS9uZXh0anMvc3JjL21pZGRsZXdhcmUudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTmV4dFJlcXVlc3QsIE5leHRSZXNwb25zZSB9IGZyb20gJ25leHQvc2VydmVyJ1xuaW1wb3J0IHsgY29ycmVsYXRpb25JRE1hbmFnZXIgfSBmcm9tICcuL2xpYi9jb3JyZWxhdGlvbi1pZCdcblxuZXhwb3J0IGZ1bmN0aW9uIG1pZGRsZXdhcmUocmVxdWVzdDogTmV4dFJlcXVlc3QpIHtcbiAgLy8gRXh0cmFjdCBjb3JyZWxhdGlvbiBJRCBmcm9tIGluY29taW5nIHJlcXVlc3QgaGVhZGVyc1xuICBjb25zdCBoZWFkZXJzID0gT2JqZWN0LmZyb21FbnRyaWVzKHJlcXVlc3QuaGVhZGVycy5lbnRyaWVzKCkpXG4gIGNvbnN0IGNvcnJlbGF0aW9uQ29udGV4dCA9IGNvcnJlbGF0aW9uSURNYW5hZ2VyLmV4dHJhY3RGcm9tSGVhZGVycyhoZWFkZXJzKVxuICBcbiAgLy8gSWYgbm8gY29ycmVsYXRpb24gY29udGV4dCBleGlzdHMsIGNyZWF0ZSBvbmVcbiAgaWYgKCFjb3JyZWxhdGlvbkNvbnRleHQpIHtcbiAgICBjb3JyZWxhdGlvbklETWFuYWdlci5nZW5lcmF0ZUNvbnRleHQoXG4gICAgICB1bmRlZmluZWQsXG4gICAgICB1bmRlZmluZWQsXG4gICAgICB1bmRlZmluZWQsXG4gICAgICB1bmRlZmluZWQsXG4gICAgICB7IFxuICAgICAgICBvcGVyYXRpb246ICdodHRwX3JlcXVlc3QnLCBcbiAgICAgICAgcGF0aDogcmVxdWVzdC5uZXh0VXJsLnBhdGhuYW1lLFxuICAgICAgICBtZXRob2Q6IHJlcXVlc3QubWV0aG9kLFxuICAgICAgICB1c2VyQWdlbnQ6IGhlYWRlcnNbJ3VzZXItYWdlbnQnXSxcbiAgICAgICAgcmVmZXJlcjogaGVhZGVyc1sncmVmZXJlciddXG4gICAgICB9XG4gICAgKVxuICB9XG5cbiAgLy8gQ2xvbmUgdGhlIHJlcXVlc3QgaGVhZGVycyB0byBhZGQgY29ycmVsYXRpb24gSURzXG4gIGNvbnN0IHJlcXVlc3RIZWFkZXJzID0gbmV3IEhlYWRlcnMocmVxdWVzdC5oZWFkZXJzKVxuICBjb25zdCBjb3JyZWxhdGlvbkhlYWRlcnMgPSBjb3JyZWxhdGlvbklETWFuYWdlci5nZXRIZWFkZXJzKClcbiAgXG4gIC8vIEFkZCBjb3JyZWxhdGlvbiBoZWFkZXJzIHRvIHRoZSByZXF1ZXN0XG4gIE9iamVjdC5lbnRyaWVzKGNvcnJlbGF0aW9uSGVhZGVycykuZm9yRWFjaCgoW2tleSwgdmFsdWVdKSA9PiB7XG4gICAgaWYgKHZhbHVlKSB7XG4gICAgICByZXF1ZXN0SGVhZGVycy5zZXQoa2V5LCB2YWx1ZSlcbiAgICB9XG4gIH0pXG5cbiAgLy8gQ3JlYXRlIGEgbmV3IHJlcXVlc3Qgd2l0aCBjb3JyZWxhdGlvbiBoZWFkZXJzXG4gIGNvbnN0IGVuaGFuY2VkUmVxdWVzdCA9IG5ldyBOZXh0UmVxdWVzdChyZXF1ZXN0LCB7XG4gICAgaGVhZGVyczogcmVxdWVzdEhlYWRlcnNcbiAgfSlcblxuICAvLyBQcm9jZXNzIHRoZSByZXF1ZXN0XG4gIGNvbnN0IHJlc3BvbnNlID0gTmV4dFJlc3BvbnNlLm5leHQoe1xuICAgIHJlcXVlc3Q6IGVuaGFuY2VkUmVxdWVzdFxuICB9KVxuXG4gIC8vIEFkZCBjb3JyZWxhdGlvbiBoZWFkZXJzIHRvIHRoZSByZXNwb25zZVxuICBPYmplY3QuZW50cmllcyhjb3JyZWxhdGlvbkhlYWRlcnMpLmZvckVhY2goKFtrZXksIHZhbHVlXSkgPT4ge1xuICAgIGlmICh2YWx1ZSkge1xuICAgICAgcmVzcG9uc2UuaGVhZGVycy5zZXQoa2V5LCB2YWx1ZSlcbiAgICB9XG4gIH0pXG5cbiAgLy8gQWRkIGFkZGl0aW9uYWwgcmVzcG9uc2UgaGVhZGVycyBmb3IgdHJhY2tpbmdcbiAgcmVzcG9uc2UuaGVhZGVycy5zZXQoJ1gtUmVxdWVzdC1JRCcsIGNvcnJlbGF0aW9uSURNYW5hZ2VyLmdldEN1cnJlbnRDb250ZXh0KCk/LnJlcXVlc3RJZCB8fCAnJylcbiAgcmVzcG9uc2UuaGVhZGVycy5zZXQoJ1gtU3Bhbi1JRCcsIGNvcnJlbGF0aW9uSURNYW5hZ2VyLmdldEN1cnJlbnRDb250ZXh0KCk/LnNwYW5JZCB8fCAnJylcbiAgcmVzcG9uc2UuaGVhZGVycy5zZXQoJ1gtVHJhY2UtSUQnLCBjb3JyZWxhdGlvbklETWFuYWdlci5nZXRDdXJyZW50Q29udGV4dCgpPy50cmFjZUlkIHx8ICcnKVxuXG4gIC8vIExvZyB0aGUgcmVxdWVzdCB3aXRoIGNvcnJlbGF0aW9uIGNvbnRleHRcbiAgY29uc3QgY3VycmVudENvbnRleHQgPSBjb3JyZWxhdGlvbklETWFuYWdlci5nZXRDdXJyZW50Q29udGV4dCgpXG4gIGlmIChjdXJyZW50Q29udGV4dCkge1xuICAgIC8vIE9ubHkgbG9nIGZvciBub24tYXNzZXQgcmVxdWVzdHMgdG8gYXZvaWQgbm9pc2VcbiAgICBpZiAoIXJlcXVlc3QubmV4dFVybC5wYXRobmFtZS5zdGFydHNXaXRoKCcvX25leHQvJykgJiYgXG4gICAgICAgICFyZXF1ZXN0Lm5leHRVcmwucGF0aG5hbWUuc3RhcnRzV2l0aCgnL2Zhdmljb24uaWNvJykgJiZcbiAgICAgICAgIXJlcXVlc3QubmV4dFVybC5wYXRobmFtZS5zdGFydHNXaXRoKCcvYXBpL2hlYWx0aCcpKSB7XG4gICAgICBjb3JyZWxhdGlvbklETWFuYWdlci5sb2dDb250ZXh0KGN1cnJlbnRDb250ZXh0LCAnaW5mbycpXG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIHJlc3BvbnNlXG59XG5cbmV4cG9ydCBjb25zdCBjb25maWcgPSB7XG4gIG1hdGNoZXI6IFtcbiAgICAvKlxuICAgICAqIE1hdGNoIGFsbCByZXF1ZXN0IHBhdGhzIGV4Y2VwdCBmb3IgdGhlIG9uZXMgc3RhcnRpbmcgd2l0aDpcbiAgICAgKiAtIGFwaSAoQVBJIHJvdXRlcylcbiAgICAgKiAtIF9uZXh0L3N0YXRpYyAoc3RhdGljIGZpbGVzKVxuICAgICAqIC0gX25leHQvaW1hZ2UgKGltYWdlIG9wdGltaXphdGlvbiBmaWxlcylcbiAgICAgKiAtIGZhdmljb24uaWNvIChmYXZpY29uIGZpbGUpXG4gICAgICovXG4gICAgJy8oKD8hYXBpfF9uZXh0L3N0YXRpY3xfbmV4dC9pbWFnZXxmYXZpY29uLmljbykuKiknLFxuICBdLFxufVxuIl0sIm5hbWVzIjpbIk5leHRSZXF1ZXN0IiwiTmV4dFJlc3BvbnNlIiwiY29ycmVsYXRpb25JRE1hbmFnZXIiLCJtaWRkbGV3YXJlIiwicmVxdWVzdCIsImhlYWRlcnMiLCJPYmplY3QiLCJmcm9tRW50cmllcyIsImVudHJpZXMiLCJjb3JyZWxhdGlvbkNvbnRleHQiLCJleHRyYWN0RnJvbUhlYWRlcnMiLCJnZW5lcmF0ZUNvbnRleHQiLCJ1bmRlZmluZWQiLCJvcGVyYXRpb24iLCJwYXRoIiwibmV4dFVybCIsInBhdGhuYW1lIiwibWV0aG9kIiwidXNlckFnZW50IiwicmVmZXJlciIsInJlcXVlc3RIZWFkZXJzIiwiSGVhZGVycyIsImNvcnJlbGF0aW9uSGVhZGVycyIsImdldEhlYWRlcnMiLCJmb3JFYWNoIiwia2V5IiwidmFsdWUiLCJzZXQiLCJlbmhhbmNlZFJlcXVlc3QiLCJyZXNwb25zZSIsIm5leHQiLCJnZXRDdXJyZW50Q29udGV4dCIsInJlcXVlc3RJZCIsInNwYW5JZCIsInRyYWNlSWQiLCJjdXJyZW50Q29udGV4dCIsInN0YXJ0c1dpdGgiLCJsb2dDb250ZXh0IiwiY29uZmlnIiwibWF0Y2hlciJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(middleware)/./src/middleware.ts\n");

/***/ })

});
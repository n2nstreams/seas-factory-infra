"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
self["webpackHotUpdate_N_E"]("middleware",{

/***/ "(middleware)/./src/lib/correlation-id.ts":
/*!***********************************!*\
  !*** ./src/lib/correlation-id.ts ***!
  \***********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   addCorrelationId: () => (/* binding */ addCorrelationId),\n/* harmony export */   correlationAwareFetch: () => (/* binding */ correlationAwareFetch),\n/* harmony export */   correlationManager: () => (/* binding */ correlationManager),\n/* harmony export */   createCorrelationAwareFetch: () => (/* binding */ createCorrelationAwareFetch),\n/* harmony export */   createCorrelationContext: () => (/* binding */ createCorrelationContext),\n/* harmony export */   createFetchOptionsWithCorrelation: () => (/* binding */ createFetchOptionsWithCorrelation),\n/* harmony export */   createHeadersWithCorrelation: () => (/* binding */ createHeadersWithCorrelation),\n/* harmony export */   extractCorrelationId: () => (/* binding */ extractCorrelationId),\n/* harmony export */   generateCorrelationId: () => (/* binding */ generateCorrelationId),\n/* harmony export */   generateSpanId: () => (/* binding */ generateSpanId),\n/* harmony export */   generateTraceId: () => (/* binding */ generateTraceId),\n/* harmony export */   logWithCorrelation: () => (/* binding */ logWithCorrelation),\n/* harmony export */   withCorrelationContext: () => (/* binding */ withCorrelationContext)\n/* harmony export */ });\n// Correlation ID service for request tracing and observability\n// Configuration\nconst CORRELATION_ID_HEADER = process.env.NEXT_PUBLIC_CORRELATION_ID_HEADER || 'X-Correlation-ID';\nconst CORRELATION_ID_LENGTH = parseInt(process.env.NEXT_PUBLIC_CORRELATION_ID_LENGTH || '16', 10);\n// Generate a unique correlation ID\nfunction generateCorrelationId() {\n    const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';\n    let result = '';\n    for(let i = 0; i < CORRELATION_ID_LENGTH; i++){\n        result += chars.charAt(Math.floor(Math.random() * chars.length));\n    }\n    return result;\n}\n// Generate a trace ID (longer, more unique identifier)\nfunction generateTraceId() {\n    return generateCorrelationId() + generateCorrelationId();\n}\n// Generate a span ID (shorter identifier for individual operations)\nfunction generateSpanId() {\n    return generateCorrelationId().substring(0, 8);\n}\n// Create a new correlation context\nfunction createCorrelationContext(parentContext, metadata = {}) {\n    const now = new Date().toISOString();\n    return {\n        id: parentContext?.id || generateCorrelationId(),\n        parentId: parentContext?.parentId,\n        traceId: parentContext?.traceId || generateTraceId(),\n        spanId: generateSpanId(),\n        userId: parentContext?.userId,\n        sessionId: parentContext?.sessionId,\n        requestId: parentContext?.requestId || generateCorrelationId(),\n        timestamp: now,\n        metadata: {\n            ...parentContext?.metadata,\n            ...metadata,\n            created_at: now\n        }\n    };\n}\n// Extract correlation ID from headers\nfunction extractCorrelationId(headers) {\n    if (headers instanceof Headers) {\n        return headers.get(CORRELATION_ID_HEADER) || null;\n    }\n    return headers[CORRELATION_ID_HEADER] || null;\n}\n// Add correlation ID to headers\nfunction addCorrelationId(headers, correlationId) {\n    if (headers instanceof Headers) {\n        headers.set(CORRELATION_ID_HEADER, correlationId);\n    } else {\n        headers[CORRELATION_ID_HEADER] = correlationId;\n    }\n}\n// Create headers with correlation ID\nfunction createHeadersWithCorrelation(correlationId, additionalHeaders = {}) {\n    return {\n        [CORRELATION_ID_HEADER]: correlationId,\n        'Content-Type': 'application/json',\n        ...additionalHeaders\n    };\n}\n// Create fetch options with correlation ID\nfunction createFetchOptionsWithCorrelation(correlationId, options = {}) {\n    return {\n        ...options,\n        headers: {\n            ...createHeadersWithCorrelation(correlationId),\n            ...options.headers\n        }\n    };\n}\n// Correlation context manager for React components\nclass CorrelationContextManager {\n    // Set the current correlation context\n    setContext(context) {\n        this.currentContext = context;\n        this.notifyListeners();\n    }\n    // Get the current correlation context\n    getContext() {\n        return this.currentContext;\n    }\n    // Create a child context\n    createChildContext(metadata = {}) {\n        if (!this.currentContext) {\n            return createCorrelationContext({}, metadata);\n        }\n        return createCorrelationContext(this.currentContext, {\n            ...metadata,\n            parent_correlation_id: this.currentContext.id\n        });\n    }\n    // Update the current context with additional metadata\n    updateContext(metadata) {\n        if (this.currentContext) {\n            this.currentContext.metadata = {\n                ...this.currentContext.metadata,\n                ...metadata,\n                updated_at: new Date().toISOString()\n            };\n            this.notifyListeners();\n        }\n    }\n    // Clear the current context\n    clearContext() {\n        this.currentContext = null;\n        this.notifyListeners();\n    }\n    // Subscribe to context changes\n    subscribe(listener) {\n        this.listeners.add(listener);\n        return ()=>{\n            this.listeners.delete(listener);\n        };\n    }\n    // Notify all listeners of context changes\n    notifyListeners() {\n        this.listeners.forEach((listener)=>{\n            try {\n                listener(this.currentContext);\n            } catch (error) {\n                console.error('Error in correlation context listener:', error);\n            }\n        });\n    }\n    constructor(){\n        this.currentContext = null;\n        this.listeners = new Set();\n    }\n}\n// Export singleton instance\nconst correlationManager = new CorrelationContextManager();\n// Utility function to log with correlation context\nfunction logWithCorrelation(level, message, data) {\n    const context = correlationManager.getContext();\n    const logData = {\n        message,\n        data,\n        correlation_id: context?.id,\n        trace_id: context?.traceId,\n        span_id: context?.spanId,\n        timestamp: new Date().toISOString()\n    };\n    switch(level){\n        case 'info':\n            console.info('📊', logData);\n            break;\n        case 'warn':\n            console.warn('⚠️', logData);\n            break;\n        case 'error':\n            console.error('❌', logData);\n            break;\n        case 'debug':\n            console.debug('🔍', logData);\n            break;\n    }\n}\n// Utility function to create a correlation-aware fetch wrapper\nfunction createCorrelationAwareFetch() {\n    return async (input, init)=>{\n        const context = correlationManager.getContext();\n        if (context) {\n            const options = createFetchOptionsWithCorrelation(context.id, init);\n            // Log the request\n            logWithCorrelation('info', 'API Request', {\n                url: typeof input === 'string' ? input : input.toString(),\n                method: options.method || 'GET',\n                correlation_id: context.id\n            });\n            try {\n                const response = await fetch(input, options);\n                // Log the response\n                logWithCorrelation('info', 'API Response', {\n                    url: typeof input === 'string' ? input : input.toString(),\n                    status: response.status,\n                    statusText: response.statusText,\n                    correlation_id: context.id\n                });\n                return response;\n            } catch (error) {\n                // Log the error\n                logWithCorrelation('error', 'API Request Failed', {\n                    url: typeof input === 'string' ? input : input.toString(),\n                    error: error instanceof Error ? error.message : String(error),\n                    correlation_id: context.id\n                });\n                throw error;\n            }\n        }\n        // Fallback to regular fetch if no correlation context\n        return fetch(input, init);\n    };\n}\n// Export the correlation-aware fetch function\nconst correlationAwareFetch = createCorrelationAwareFetch();\n// Utility function to wrap async operations with correlation context\nfunction withCorrelationContext(operation, metadata = {}) {\n    const childContext = correlationManager.createChildContext(metadata);\n    correlationManager.setContext(childContext);\n    return operation().finally(()=>{\n        // Restore parent context if it exists\n        if (childContext.parentId) {\n            const parentContext = correlationManager.getContext();\n            if (parentContext && parentContext.id === childContext.parentId) {\n                correlationManager.setContext(parentContext);\n            }\n        }\n    });\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKG1pZGRsZXdhcmUpLy4vc3JjL2xpYi9jb3JyZWxhdGlvbi1pZC50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7O0FBQUEsK0RBQStEO0FBRS9ELGdCQUFnQjtBQUNoQixNQUFNQSx3QkFBd0JDLFFBQVFDLEdBQUcsQ0FBQ0MsaUNBQWlDLElBQUk7QUFDL0UsTUFBTUMsd0JBQXdCQyxTQUFTSixRQUFRQyxHQUFHLENBQUNJLGlDQUFpQyxJQUFJLE1BQU07QUFlOUYsbUNBQW1DO0FBQzVCLFNBQVNDO0lBQ2QsTUFBTUMsUUFBUTtJQUNkLElBQUlDLFNBQVM7SUFDYixJQUFLLElBQUlDLElBQUksR0FBR0EsSUFBSU4sdUJBQXVCTSxJQUFLO1FBQzlDRCxVQUFVRCxNQUFNRyxNQUFNLENBQUNDLEtBQUtDLEtBQUssQ0FBQ0QsS0FBS0UsTUFBTSxLQUFLTixNQUFNTyxNQUFNO0lBQ2hFO0lBQ0EsT0FBT047QUFDVDtBQUVBLHVEQUF1RDtBQUNoRCxTQUFTTztJQUNkLE9BQU9ULDBCQUEwQkE7QUFDbkM7QUFFQSxvRUFBb0U7QUFDN0QsU0FBU1U7SUFDZCxPQUFPVix3QkFBd0JXLFNBQVMsQ0FBQyxHQUFHO0FBQzlDO0FBRUEsbUNBQW1DO0FBQzVCLFNBQVNDLHlCQUNkQyxhQUEyQyxFQUMzQ0MsV0FBZ0MsQ0FBQyxDQUFDO0lBRWxDLE1BQU1DLE1BQU0sSUFBSUMsT0FBT0MsV0FBVztJQUVsQyxPQUFPO1FBQ0xDLElBQUlMLGVBQWVLLE1BQU1sQjtRQUN6Qm1CLFVBQVVOLGVBQWVNO1FBQ3pCQyxTQUFTUCxlQUFlTyxXQUFXWDtRQUNuQ1ksUUFBUVg7UUFDUlksUUFBUVQsZUFBZVM7UUFDdkJDLFdBQVdWLGVBQWVVO1FBQzFCQyxXQUFXWCxlQUFlVyxhQUFheEI7UUFDdkN5QixXQUFXVjtRQUNYRCxVQUFVO1lBQ1IsR0FBR0QsZUFBZUMsUUFBUTtZQUMxQixHQUFHQSxRQUFRO1lBQ1hZLFlBQVlYO1FBQ2Q7SUFDRjtBQUNGO0FBRUEsc0NBQXNDO0FBQy9CLFNB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ZCxnQkFBZ0I7Z0JBQ2hCSSxtQkFBbUIsU0FBUyxzQkFBc0I7b0JBQ2hEYyxLQUFLLE9BQU9GLFVBQVUsV0FBV0EsUUFBUUEsTUFBTUcsUUFBUTtvQkFDdkRuQixPQUFPQSxpQkFBaUJ5QixRQUFRekIsTUFBTU0sT0FBTyxHQUFHb0IsT0FBTzFCO29CQUN2RFMsZ0JBQWdCeEIsUUFBUXRCLEVBQUU7Z0JBQzVCO2dCQUVBLE1BQU1xQztZQUNSO1FBQ0Y7UUFFQSxzREFBc0Q7UUFDdEQsT0FBT3NCLE1BQU1OLE9BQU9DO0lBQ3RCO0FBQ0Y7QUFFQSw4Q0FBOEM7QUFDdkMsTUFBTVUsd0JBQXdCWiw4QkFBNkI7QUFFbEUscUVBQXFFO0FBQzlELFNBQVNhLHVCQUNkQyxTQUEyQixFQUMzQnRFLFdBQWdDLENBQUMsQ0FBQztJQUVsQyxNQUFNdUUsZUFBZTNCLG1CQUFtQmQsa0JBQWtCLENBQUM5QjtJQUMzRDRDLG1CQUFtQm5CLFVBQVUsQ0FBQzhDO0lBRTlCLE9BQU9ELFlBQVlFLE9BQU8sQ0FBQztRQUN6QixzQ0FBc0M7UUFDdEMsSUFBSUQsYUFBYWxFLFFBQVEsRUFBRTtZQUN6QixNQUFNTixnQkFBZ0I2QyxtQkFBbUJmLFVBQVU7WUFDbkQsSUFBSTlCLGlCQUFpQkEsY0FBY0ssRUFBRSxLQUFLbUUsYUFBYWxFLFFBQVEsRUFBRTtnQkFDL0R1QyxtQkFBbUJuQixVQUFVLENBQUMxQjtZQUNoQztRQUNGO0lBQ0Y7QUFDRiIsInNvdXJjZXMiOlsiL1VzZXJzL21hY21pbmkvRG9jdW1lbnRzL1Byb2plY3RzL1NhYVMgRmFjdG9yeS91aS9uZXh0anMvc3JjL2xpYi9jb3JyZWxhdGlvbi1pZC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3JyZWxhdGlvbiBJRCBzZXJ2aWNlIGZvciByZXF1ZXN0IHRyYWNpbmcgYW5kIG9ic2VydmFiaWxpdHlcblxuLy8gQ29uZmlndXJhdGlvblxuY29uc3QgQ09SUkVMQVRJT05fSURfSEVBREVSID0gcHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfQ09SUkVMQVRJT05fSURfSEVBREVSIHx8ICdYLUNvcnJlbGF0aW9uLUlEJ1xuY29uc3QgQ09SUkVMQVRJT05fSURfTEVOR1RIID0gcGFyc2VJbnQocHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfQ09SUkVMQVRJT05fSURfTEVOR1RIIHx8ICcxNicsIDEwKVxuXG4vLyBDb3JyZWxhdGlvbiBJRCBpbnRlcmZhY2VcbmV4cG9ydCBpbnRlcmZhY2UgQ29ycmVsYXRpb25Db250ZXh0IHtcbiAgaWQ6IHN0cmluZ1xuICBwYXJlbnRJZD86IHN0cmluZ1xuICB0cmFjZUlkPzogc3RyaW5nXG4gIHNwYW5JZD86IHN0cmluZ1xuICB1c2VySWQ/OiBzdHJpbmdcbiAgc2Vzc2lvbklkPzogc3RyaW5nXG4gIHJlcXVlc3RJZD86IHN0cmluZ1xuICB0aW1lc3RhbXA6IHN0cmluZ1xuICBtZXRhZGF0YTogUmVjb3JkPHN0cmluZywgYW55PlxufVxuXG4vLyBHZW5lcmF0ZSBhIHVuaXF1ZSBjb3JyZWxhdGlvbiBJRFxuZXhwb3J0IGZ1bmN0aW9uIGdlbmVyYXRlQ29ycmVsYXRpb25JZCgpOiBzdHJpbmcge1xuICBjb25zdCBjaGFycyA9ICdBQkNERUZHSElKS0xNTk9QUVJTVFVWV1hZWmFiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6MDEyMzQ1Njc4OSdcbiAgbGV0IHJlc3VsdCA9ICcnXG4gIGZvciAobGV0IGkgPSAwOyBpIDwgQ09SUkVMQVRJT05fSURfTEVOR1RIOyBpKyspIHtcbiAgICByZXN1bHQgKz0gY2hhcnMuY2hhckF0KE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIGNoYXJzLmxlbmd0aCkpXG4gIH1cbiAgcmV0dXJuIHJlc3VsdFxufVxuXG4vLyBHZW5lcmF0ZSBhIHRyYWNlIElEIChsb25nZXIsIG1vcmUgdW5pcXVlIGlkZW50aWZpZXIpXG5leHBvcnQgZnVuY3Rpb24gZ2VuZXJhdGVUcmFjZUlkKCk6IHN0cmluZyB7XG4gIHJldHVybiBnZW5lcmF0ZUNvcnJlbGF0aW9uSWQoKSArIGdlbmVyYXRlQ29ycmVsYXRpb25JZCgpXG59XG5cbi8vIEdlbmVyYXRlIGEgc3BhbiBJRCAoc2hvcnRlciBpZGVudGlmaWVyIGZvciBpbmRpdmlkdWFsIG9wZXJhdGlvbnMpXG5leHBvcnQgZnVuY3Rpb24gZ2VuZXJhdGVTcGFuSWQoKTogc3RyaW5nIHtcbiAgcmV0dXJuIGdlbmVyYXRlQ29ycmVsYXRpb25JZCgpLnN1YnN0cmluZygwLCA4KVxufVxuXG4vLyBDcmVhdGUgYSBuZXcgY29ycmVsYXRpb24gY29udGV4dFxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZUNvcnJlbGF0aW9uQ29udGV4dChcbiAgcGFyZW50Q29udGV4dD86IFBhcnRpYWw8Q29ycmVsYXRpb25Db250ZXh0PixcbiAgbWV0YWRhdGE6IFJlY29yZDxzdHJpbmcsIGFueT4gPSB7fVxuKTogQ29ycmVsYXRpb25Db250ZXh0IHtcbiAgY29uc3Qgbm93ID0gbmV3IERhdGUoKS50b0lTT1N0cmluZygpXG4gIFxuICByZXR1cm4ge1xuICAgIGlkOiBwYXJlbnRDb250ZXh0Py5pZCB8fCBnZW5lcmF0ZUNvcnJlbGF0aW9uSWQoKSxcbiAgICBwYXJlbnRJZDogcGFyZW50Q29udGV4dD8ucGFyZW50SWQsXG4gICAgdHJhY2VJZDogcGFyZW50Q29udGV4dD8udHJhY2VJZCB8fCBnZW5lcmF0ZVRyYWNlSWQoKSxcbiAgICBzcGFuSWQ6IGdlbmVyYXRlU3BhbklkKCksXG4gICAgdXNlcklkOiBwYXJlbnRDb250ZXh0Py51c2VySWQsXG4gICAgc2Vzc2lvbklkOiBwYXJlbnRDb250ZXh0Py5zZXNzaW9uSWQsXG4gICAgcmVxdWVzdElkOiBwYXJlbnRDb250ZXh0Py5yZXF1ZXN0SWQgfHwgZ2VuZXJhdGVDb3JyZWxhdGlvbklkKCksXG4gICAgdGltZXN0YW1wOiBub3csXG4gICAgbWV0YWRhdGE6IHtcbiAgICAgIC4uLnBhcmVudENvbnRleHQ/Lm1ldGFkYXRhLFxuICAgICAgLi4ubWV0YWRhdGEsXG4gICAgICBjcmVhdGVkX2F0OiBub3csXG4gICAgfSxcbiAgfVxufVxuXG4vLyBFeHRyYWN0IGNvcnJlbGF0aW9uIElEIGZyb20gaGVhZGVyc1xuZXhwb3J0IGZ1bmN0aW9uIGV4dHJhY3RDb3JyZWxhdGlvbklkKGhlYWRlcnM6IEhlYWRlcnMgfCBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+KTogc3RyaW5nIHwgbnVsbCB7XG4gIGlmIChoZWFkZXJzIGluc3RhbmNlb2YgSGVhZGVycykge1xuICAgIHJldHVybiBoZWFkZXJzLmdldChDT1JSRUxBVElPTl9JRF9IRUFERVIpIHx8IG51bGxcbiAgfVxuICByZXR1cm4gaGVhZGVyc1tDT1JSRUxBVElPTl9JRF9IRUFERVJdIHx8IG51bGxcbn1cblxuLy8gQWRkIGNvcnJlbGF0aW9uIElEIHRvIGhlYWRlcnNcbmV4cG9ydCBmdW5jdGlvbiBhZGRDb3JyZWxhdGlvbklkKFxuICBoZWFkZXJzOiBIZWFkZXJzIHwgUmVjb3JkPHN0cmluZywgc3RyaW5nPixcbiAgY29ycmVsYXRpb25JZDogc3RyaW5nXG4pOiB2b2lkIHtcbiAgaWYgKGhlYWRlcnMgaW5zdGFuY2VvZiBIZWFkZXJzKSB7XG4gICAgaGVhZGVycy5zZXQoQ09SUkVMQVRJT05fSURfSEVBREVSLCBjb3JyZWxhdGlvbklkKVxuICB9IGVsc2Uge1xuICAgIGhlYWRlcnNbQ09SUkVMQVRJT05fSURfSEVBREVSXSA9IGNvcnJlbGF0aW9uSWRcbiAgfVxufVxuXG4vLyBDcmVhdGUgaGVhZGVycyB3aXRoIGNvcnJlbGF0aW9uIElEXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlSGVhZGVyc1dpdGhDb3JyZWxhdGlvbihcbiAgY29ycmVsYXRpb25JZDogc3RyaW5nLFxuICBhZGRpdGlvbmFsSGVhZGVyczogUmVjb3JkPHN0cmluZywgc3RyaW5nPiA9IHt9XG4pOiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+IHtcbiAgcmV0dXJuIHtcbiAgICBbQ09SUkVMQVRJT05fSURfSEVBREVSXTogY29ycmVsYXRpb25JZCxcbiAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nLFxuICAgIC4uLmFkZGl0aW9uYWxIZWFkZXJzLFxuICB9XG59XG5cbi8vIENyZWF0ZSBmZXRjaCBvcHRpb25zIHdpdGggY29ycmVsYXRpb24gSURcbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVGZXRjaE9wdGlvbnNXaXRoQ29ycmVsYXRpb24oXG4gIGNvcnJlbGF0aW9uSWQ6IHN0cmluZyxcbiAgb3B0aW9uczogUmVxdWVzdEluaXQgPSB7fVxuKTogUmVxdWVzdEluaXQge1xuICByZXR1cm4ge1xuICAgIC4uLm9wdGlvbnMsXG4gICAgaGVhZGVyczoge1xuICAgICAgLi4uY3JlYXRlSGVhZGVyc1dpdGhDb3JyZWxhdGlvbihjb3JyZWxhdGlvbklkKSxcbiAgICAgIC4uLm9wdGlvbnMuaGVhZGVycyxcbiAgICB9LFxuICB9XG59XG5cbi8vIENvcnJlbGF0aW9uIGNvbnRleHQgbWFuYWdlciBmb3IgUmVhY3QgY29tcG9uZW50c1xuY2xhc3MgQ29ycmVsYXRpb25Db250ZXh0TWFuYWdlciB7XG4gIHByaXZhdGUgY3VycmVudENvbnRleHQ6IENvcnJlbGF0aW9uQ29udGV4dCB8IG51bGwgPSBudWxsXG4gIHByaXZhdGUgbGlzdGVuZXJzOiBTZXQ8KGNvbnRleHQ6IENvcnJlbGF0aW9uQ29udGV4dCB8IG51bGwpID0+IHZvaWQ+ID0gbmV3IFNldCgpXG5cbiAgLy8gU2V0IHRoZSBjdXJyZW50IGNvcnJlbGF0aW9uIGNvbnRleHRcbiAgc2V0Q29udGV4dChjb250ZXh0OiBDb3JyZWxhdGlvbkNvbnRleHQpOiB2b2lkIHtcbiAgICB0aGlzLmN1cnJlbnRDb250ZXh0ID0gY29udGV4dFxuICAgIHRoaXMubm90aWZ5TGlzdGVuZXJzKClcbiAgfVxuXG4gIC8vIEdldCB0aGUgY3VycmVudCBjb3JyZWxhdGlvbiBjb250ZXh0XG4gIGdldENvbnRleHQoKTogQ29ycmVsYXRpb25Db250ZXh0IHwgbnVsbCB7XG4gICAgcmV0dXJuIHRoaXMuY3VycmVudENvbnRleHRcbiAgfVxuXG4gIC8vIENyZWF0ZSBhIGNoaWxkIGNvbnRleHRcbiAgY3JlYXRlQ2hpbGRDb250ZXh0KG1ldGFkYXRhOiBSZWNvcmQ8c3RyaW5nLCBhbnk+ID0ge30pOiBDb3JyZWxhdGlvbkNvbnRleHQge1xuICAgIGlmICghdGhpcy5jdXJyZW50Q29udGV4dCkge1xuICAgICAgcmV0dXJuIGNyZWF0ZUNvcnJlbGF0aW9uQ29udGV4dCh7fSwgbWV0YWRhdGEpXG4gICAgfVxuICAgIFxuICAgIHJldHVybiBjcmVhdGVDb3JyZWxhdGlvbkNvbnRleHQodGhpcy5jdXJyZW50Q29udGV4dCwge1xuICAgICAgLi4ubWV0YWRhdGEsXG4gICAgICBwYXJlbnRfY29ycmVsYXRpb25faWQ6IHRoaXMuY3VycmVudENvbnRleHQuaWQsXG4gICAgfSlcbiAgfVxuXG4gIC8vIFVwZGF0ZSB0aGUgY3VycmVudCBjb250ZXh0IHdpdGggYWRkaXRpb25hbCBtZXRhZGF0YVxuICB1cGRhdGVDb250ZXh0KG1ldGFkYXRhOiBSZWNvcmQ8c3RyaW5nLCBhbnk+KTogdm9pZCB7XG4gICAgaWYgKHRoaXMuY3VycmVudENvbnRleHQpIHtcbiAgICAgIHRoaXMuY3VycmVudENvbnRleHQubWV0YWRhdGEgPSB7XG4gICAgICAgIC4uLnRoaXMuY3VycmVudENvbnRleHQubWV0YWRhdGEsXG4gICAgICAgIC4uLm1ldGFkYXRhLFxuICAgICAgICB1cGRhdGVkX2F0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgICB9XG4gICAgICB0aGlzLm5vdGlmeUxpc3RlbmVycygpXG4gICAgfVxuICB9XG5cbiAgLy8gQ2xlYXIgdGhlIGN1cnJlbnQgY29udGV4dFxuICBjbGVhckNvbnRleHQoKTogdm9pZCB7XG4gICAgdGhpcy5jdXJyZW50Q29udGV4dCA9IG51bGxcbiAgICB0aGlzLm5vdGlmeUxpc3RlbmVycygpXG4gIH1cblxuICAvLyBTdWJzY3JpYmUgdG8gY29udGV4dCBjaGFuZ2VzXG4gIHN1YnNjcmliZShsaXN0ZW5lcjogKGNvbnRleHQ6IENvcnJlbGF0aW9uQ29udGV4dCB8IG51bGwpID0+IHZvaWQpOiAoKSA9PiB2b2lkIHtcbiAgICB0aGlzLmxpc3RlbmVycy5hZGQobGlzdGVuZXIpXG4gICAgcmV0dXJuICgpID0+IHtcbiAgICAgIHRoaXMubGlzdGVuZXJzLmRlbGV0ZShsaXN0ZW5lcilcbiAgICB9XG4gIH1cblxuICAvLyBOb3RpZnkgYWxsIGxpc3RlbmVycyBvZiBjb250ZXh0IGNoYW5nZXNcbiAgcHJpdmF0ZSBub3RpZnlMaXN0ZW5lcnMoKTogdm9pZCB7XG4gICAgdGhpcy5saXN0ZW5lcnMuZm9yRWFjaChsaXN0ZW5lciA9PiB7XG4gICAgICB0cnkge1xuICAgICAgICBsaXN0ZW5lcih0aGlzLmN1cnJlbnRDb250ZXh0KVxuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgaW4gY29ycmVsYXRpb24gY29udGV4dCBsaXN0ZW5lcjonLCBlcnJvcilcbiAgICAgIH1cbiAgICB9KVxuICB9XG59XG5cbi8vIEV4cG9ydCBzaW5nbGV0b24gaW5zdGFuY2VcbmV4cG9ydCBjb25zdCBjb3JyZWxhdGlvbk1hbmFnZXIgPSBuZXcgQ29ycmVsYXRpb25Db250ZXh0TWFuYWdlcigpXG5cbi8vIFV0aWxpdHkgZnVuY3Rpb24gdG8gbG9nIHdpdGggY29ycmVsYXRpb24gY29udGV4dFxuZXhwb3J0IGZ1bmN0aW9uIGxvZ1dpdGhDb3JyZWxhdGlvbihcbiAgbGV2ZWw6ICdpbmZvJyB8ICd3YXJuJyB8ICdlcnJvcicgfCAnZGVidWcnLFxuICBtZXNzYWdlOiBzdHJpbmcsXG4gIGRhdGE/OiBhbnlcbik6IHZvaWQge1xuICBjb25zdCBjb250ZXh0ID0gY29ycmVsYXRpb25NYW5hZ2VyLmdldENvbnRleHQoKVxuICBjb25zdCBsb2dEYXRhID0ge1xuICAgIG1lc3NhZ2UsXG4gICAgZGF0YSxcbiAgICBjb3JyZWxhdGlvbl9pZDogY29udGV4dD8uaWQsXG4gICAgdHJhY2VfaWQ6IGNvbnRleHQ/LnRyYWNlSWQsXG4gICAgc3Bhbl9pZDogY29udGV4dD8uc3BhbklkLFxuICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICB9XG5cbiAgc3dpdGNoIChsZXZlbCkge1xuICAgIGNhc2UgJ2luZm8nOlxuICAgICAgY29uc29sZS5pbmZvKCfwn5OKJywgbG9nRGF0YSlcbiAgICAgIGJyZWFrXG4gICAgY2FzZSAnd2Fybic6XG4gICAgICBjb25zb2xlLndhcm4oJ+KaoO+4jycsIGxvZ0RhdGEpXG4gICAgICBicmVha1xuICAgIGNhc2UgJ2Vycm9yJzpcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCcsIGxvZ0RhdGEpXG4gICAgICBicmVha1xuICAgIGNhc2UgJ2RlYnVnJzpcbiAgICAgIGNvbnNvbGUuZGVidWcoJ/CflI0nLCBsb2dEYXRhKVxuICAgICAgYnJlYWtcbiAgfVxufVxuXG4vLyBVdGlsaXR5IGZ1bmN0aW9uIHRvIGNyZWF0ZSBhIGNvcnJlbGF0aW9uLWF3YXJlIGZldGNoIHdyYXBwZXJcbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVDb3JyZWxhdGlvbkF3YXJlRmV0Y2goKTogdHlwZW9mIGZldGNoIHtcbiAgcmV0dXJuIGFzeW5jIChpbnB1dDogUmVxdWVzdEluZm8gfCBVUkwsIGluaXQ/OiBSZXF1ZXN0SW5pdCk6IFByb21pc2U8UmVzcG9uc2U+ID0+IHtcbiAgICBjb25zdCBjb250ZXh0ID0gY29ycmVsYXRpb25NYW5hZ2VyLmdldENvbnRleHQoKVxuICAgIFxuICAgIGlmIChjb250ZXh0KSB7XG4gICAgICBjb25zdCBvcHRpb25zID0gY3JlYXRlRmV0Y2hPcHRpb25zV2l0aENvcnJlbGF0aW9uKGNvbnRleHQuaWQsIGluaXQpXG4gICAgICBcbiAgICAgIC8vIExvZyB0aGUgcmVxdWVzdFxuICAgICAgbG9nV2l0aENvcnJlbGF0aW9uKCdpbmZvJywgJ0FQSSBSZXF1ZXN0Jywge1xuICAgICAgICB1cmw6IHR5cGVvZiBpbnB1dCA9PT0gJ3N0cmluZycgPyBpbnB1dCA6IGlucHV0LnRvU3RyaW5nKCksXG4gICAgICAgIG1ldGhvZDogb3B0aW9ucy5tZXRob2QgfHwgJ0dFVCcsXG4gICAgICAgIGNvcnJlbGF0aW9uX2lkOiBjb250ZXh0LmlkLFxuICAgICAgfSlcbiAgICAgIFxuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaChpbnB1dCwgb3B0aW9ucylcbiAgICAgICAgXG4gICAgICAgIC8vIExvZyB0aGUgcmVzcG9uc2VcbiAgICAgICAgbG9nV2l0aENvcnJlbGF0aW9uKCdpbmZvJywgJ0FQSSBSZXNwb25zZScsIHtcbiAgICAgICAgICB1cmw6IHR5cGVvZiBpbnB1dCA9PT0gJ3N0cmluZycgPyBpbnB1dCA6IGlucHV0LnRvU3RyaW5nKCksXG4gICAgICAgICAgc3RhdHVzOiByZXNwb25zZS5zdGF0dXMsXG4gICAgICAgICAgc3RhdHVzVGV4dDogcmVzcG9uc2Uuc3RhdHVzVGV4dCxcbiAgICAgICAgICBjb3JyZWxhdGlvbl9pZDogY29udGV4dC5pZCxcbiAgICAgICAgfSlcbiAgICAgICAgXG4gICAgICAgIHJldHVybiByZXNwb25zZVxuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgLy8gTG9nIHRoZSBlcnJvclxuICAgICAgICBsb2dXaXRoQ29ycmVsYXRpb24oJ2Vycm9yJywgJ0FQSSBSZXF1ZXN0IEZhaWxlZCcsIHtcbiAgICAgICAgICB1cmw6IHR5cGVvZiBpbnB1dCA9PT0gJ3N0cmluZycgPyBpbnB1dCA6IGlucHV0LnRvU3RyaW5nKCksXG4gICAgICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogU3RyaW5nKGVycm9yKSxcbiAgICAgICAgICBjb3JyZWxhdGlvbl9pZDogY29udGV4dC5pZCxcbiAgICAgICAgfSlcbiAgICAgICAgXG4gICAgICAgIHRocm93IGVycm9yXG4gICAgICB9XG4gICAgfVxuICAgIFxuICAgIC8vIEZhbGxiYWNrIHRvIHJlZ3VsYXIgZmV0Y2ggaWYgbm8gY29ycmVsYXRpb24gY29udGV4dFxuICAgIHJldHVybiBmZXRjaChpbnB1dCwgaW5pdClcbiAgfVxufVxuXG4vLyBFeHBvcnQgdGhlIGNvcnJlbGF0aW9uLWF3YXJlIGZldGNoIGZ1bmN0aW9uXG5leHBvcnQgY29uc3QgY29ycmVsYXRpb25Bd2FyZUZldGNoID0gY3JlYXRlQ29ycmVsYXRpb25Bd2FyZUZldGNoKClcblxuLy8gVXRpbGl0eSBmdW5jdGlvbiB0byB3cmFwIGFzeW5jIG9wZXJhdGlvbnMgd2l0aCBjb3JyZWxhdGlvbiBjb250ZXh0XG5leHBvcnQgZnVuY3Rpb24gd2l0aENvcnJlbGF0aW9uQ29udGV4dDxUPihcbiAgb3BlcmF0aW9uOiAoKSA9PiBQcm9taXNlPFQ+LFxuICBtZXRhZGF0YTogUmVjb3JkPHN0cmluZywgYW55PiA9IHt9XG4pOiBQcm9taXNlPFQ+IHtcbiAgY29uc3QgY2hpbGRDb250ZXh0ID0gY29ycmVsYXRpb25NYW5hZ2VyLmNyZWF0ZUNoaWxkQ29udGV4dChtZXRhZGF0YSlcbiAgY29ycmVsYXRpb25NYW5hZ2VyLnNldENvbnRleHQoY2hpbGRDb250ZXh0KVxuICBcbiAgcmV0dXJuIG9wZXJhdGlvbigpLmZpbmFsbHkoKCkgPT4ge1xuICAgIC8vIFJlc3RvcmUgcGFyZW50IGNvbnRleHQgaWYgaXQgZXhpc3RzXG4gICAgaWYgKGNoaWxkQ29udGV4dC5wYXJlbnRJZCkge1xuICAgICAgY29uc3QgcGFyZW50Q29udGV4dCA9IGNvcnJlbGF0aW9uTWFuYWdlci5nZXRDb250ZXh0KClcbiAgICAgIGlmIChwYXJlbnRDb250ZXh0ICYmIHBhcmVudENvbnRleHQuaWQgPT09IGNoaWxkQ29udGV4dC5wYXJlbnRJZCkge1xuICAgICAgICBjb3JyZWxhdGlvbk1hbmFnZXIuc2V0Q29udGV4dChwYXJlbnRDb250ZXh0KVxuICAgICAgfVxuICAgIH1cbiAgfSlcbn1cblxuLy8gRXhwb3J0IHR5cGVzIGZvciBleHRlcm5hbCB1c2VcbmV4cG9ydCB0eXBlIHsgQ29ycmVsYXRpb25Db250ZXh0IH1cbiJdLCJuYW1lcyI6WyJDT1JSRUxBVElPTl9JRF9IRUFERVIiLCJwcm9jZXNzIiwiZW52IiwiTkVYVF9QVUJMSUNfQ09SUkVMQVRJT05fSURfSEVBREVSIiwiQ09SUkVMQVRJT05fSURfTEVOR1RIIiwicGFyc2VJbnQiLCJORVhUX1BVQkxJQ19DT1JSRUxBVElPTl9JRF9MRU5HVEgiLCJnZW5lcmF0ZUNvcnJlbGF0aW9uSWQiLCJjaGFycyIsInJlc3VsdCIsImkiLCJjaGFyQXQiLCJNYXRoIiwiZmxvb3IiLCJyYW5kb20iLCJsZW5ndGgiLCJnZW5lcmF0ZVRyYWNlSWQiLCJnZW5lcmF0ZVNwYW5JZCIsInN1YnN0cmluZyIsImNyZWF0ZUNvcnJlbGF0aW9uQ29udGV4dCIsInBhcmVudENvbnRleHQiLCJtZXRhZGF0YSIsIm5vdyIsIkRhdGUiLCJ0b0lTT1N0cmluZyIsImlkIiwicGFyZW50SWQiLCJ0cmFjZUlkIiwic3BhbklkIiwidXNlcklkIiwic2Vzc2lvbklkIiwicmVxdWVzdElkIiwidGltZXN0YW1wIiwiY3JlYXRlZF9hdCIsImV4dHJhY3RDb3JyZWxhdGlvbklkIiwiaGVhZGVycyIsIkhlYWRlcnMiLCJnZXQiLCJhZGRDb3JyZWxhdGlvbklkIiwiY29ycmVsYXRpb25JZCIsInNldCIsImNyZWF0ZUhlYWRlcnNXaXRoQ29ycmVsYXRpb24iLCJhZGRpdGlvbmFsSGVhZGVycyIsImNyZWF0ZUZldGNoT3B0aW9uc1dpdGhDb3JyZWxhdGlvbiIsIm9wdGlvbnMiLCJDb3JyZWxhdGlvbkNvbnRleHRNYW5hZ2VyIiwic2V0Q29udGV4dCIsImNvbnRleHQiLCJjdXJyZW50Q29udGV4dCIsIm5vdGlmeUxpc3RlbmVycyIsImdldENvbnRleHQiLCJjcmVhdGVDaGlsZENvbnRleHQiLCJwYXJlbnRfY29ycmVsYXRpb25faWQiLCJ1cGRhdGVDb250ZXh0IiwidXBkYXRlZF9hdCIsImNsZWFyQ29udGV4dCIsInN1YnNjcmliZSIsImxpc3RlbmVyIiwibGlzdGVuZXJzIiwiYWRkIiwiZGVsZXRlIiwiZm9yRWFjaCIsImVycm9yIiwiY29uc29sZSIsIlNldCIsImNvcnJlbGF0aW9uTWFuYWdlciIsImxvZ1dpdGhDb3JyZWxhdGlvbiIsImxldmVsIiwibWVzc2FnZSIsImRhdGEiLCJsb2dEYXRhIiwiY29ycmVsYXRpb25faWQiLCJ0cmFjZV9pZCIsInNwYW5faWQiLCJpbmZvIiwid2FybiIsImRlYnVnIiwiY3JlYXRlQ29ycmVsYXRpb25Bd2FyZUZldGNoIiwiaW5wdXQiLCJpbml0IiwidXJsIiwidG9TdHJpbmciLCJtZXRob2QiLCJyZXNwb25zZSIsImZldGNoIiwic3RhdHVzIiwic3RhdHVzVGV4dCIsIkVycm9yIiwiU3RyaW5nIiwiY29ycmVsYXRpb25Bd2FyZUZldGNoIiwid2l0aENvcnJlbGF0aW9uQ29udGV4dCIsIm9wZXJhdGlvbiIsImNoaWxkQ29udGV4dCIsImZpbmFsbHkiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(middleware)/./src/lib/correlation-id.ts\n");

/***/ }),

/***/ "(middleware)/./src/middleware.ts":
/*!***************************!*\
  !*** ./src/middleware.ts ***!
  \***************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   middleware: () => (/* binding */ middleware)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(middleware)/./node_modules/next/dist/esm/api/server.js\");\n/* harmony import */ var _lib_correlation_id__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./lib/correlation-id */ \"(middleware)/./src/lib/correlation-id.ts\");\n\n\nfunction middleware(request) {\n    // Extract correlation ID from incoming request headers\n    const headers = Object.fromEntries(request.headers.entries());\n    const correlationContext = _lib_correlation_id__WEBPACK_IMPORTED_MODULE_1__.correlationIDManager.extractFromHeaders(headers);\n    // If no correlation context exists, create one\n    if (!correlationContext) {\n        _lib_correlation_id__WEBPACK_IMPORTED_MODULE_1__.correlationIDManager.generateContext(undefined, undefined, undefined, undefined, {\n            operation: 'http_request',\n            path: request.nextUrl.pathname,\n            method: request.method,\n            userAgent: headers['user-agent'],\n            referer: headers['referer']\n        });\n    }\n    // Clone the request headers to add correlation IDs\n    const requestHeaders = new Headers(request.headers);\n    const correlationHeaders = _lib_correlation_id__WEBPACK_IMPORTED_MODULE_1__.correlationIDManager.getHeaders();\n    // Add correlation headers to the request\n    Object.entries(correlationHeaders).forEach(([key, value])=>{\n        if (value) {\n            requestHeaders.set(key, value);\n        }\n    });\n    // Create a new request with correlation headers\n    const enhancedRequest = new next_server__WEBPACK_IMPORTED_MODULE_0__.NextRequest(request, {\n        headers: requestHeaders\n    });\n    // Process the request\n    const response = next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.next({\n        request: enhancedRequest\n    });\n    // Add correlation headers to the response\n    Object.entries(correlationHeaders).forEach(([key, value])=>{\n        if (value) {\n            response.headers.set(key, value);\n        }\n    });\n    // Add additional response headers for tracking\n    response.headers.set('X-Request-ID', _lib_correlation_id__WEBPACK_IMPORTED_MODULE_1__.correlationIDManager.getCurrentContext()?.requestId || '');\n    response.headers.set('X-Span-ID', _lib_correlation_id__WEBPACK_IMPORTED_MODULE_1__.correlationIDManager.getCurrentContext()?.spanId || '');\n    response.headers.set('X-Trace-ID', _lib_correlation_id__WEBPACK_IMPORTED_MODULE_1__.correlationIDManager.getCurrentContext()?.traceId || '');\n    // Log the request with correlation context\n    const currentContext = _lib_correlation_id__WEBPACK_IMPORTED_MODULE_1__.correlationIDManager.getCurrentContext();\n    if (currentContext) {\n        // Only log for non-asset requests to avoid noise\n        if (!request.nextUrl.pathname.startsWith('/_next/') && !request.nextUrl.pathname.startsWith('/favicon.ico') && !request.nextUrl.pathname.startsWith('/api/health')) {\n            _lib_correlation_id__WEBPACK_IMPORTED_MODULE_1__.correlationIDManager.logContext(currentContext, 'info');\n        }\n    }\n    return response;\n}\nconst config = {\n    matcher: [\n        /*\n     * Match all request paths except for the ones starting with:\n     * - api (API routes)\n     * - _next/static (static files)\n     * - _next/image (image optimization files)\n     * - favicon.ico (favicon file)\n     */ '/((?!api|_next/static|_next/image|favicon.ico).*)'\n    ]\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKG1pZGRsZXdhcmUpLy4vc3JjL21pZGRsZXdhcmUudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUF1RDtBQUNJO0FBRXBELFNBQVNHLFdBQVdDLE9BQW9CO0lBQzdDLHVEQUF1RDtJQUN2RCxNQUFNQyxVQUFVQyxPQUFPQyxXQUFXLENBQUNILFFBQVFDLE9BQU8sQ0FBQ0csT0FBTztJQUMxRCxNQUFNQyxxQkFBcUJQLHdGQUF1QyxDQUFDRztJQUVuRSwrQ0FBK0M7SUFDL0MsSUFBSSxDQUFDSSxvQkFBb0I7UUFDdkJQLHFGQUFvQyxDQUNsQ1UsV0FDQUEsV0FDQUEsV0FDQUEsV0FDQTtZQUNFQyxXQUFXO1lBQ1hDLE1BQU1WLFFBQVFXLE9BQU8sQ0FBQ0MsUUFBUTtZQUM5QkMsUUFBUWIsUUFBUWEsTUFBTTtZQUN0QkMsV0FBV2IsT0FBTyxDQUFDLGFBQWE7WUFDaENjLFNBQVNkLE9BQU8sQ0FBQyxVQUFVO1FBQzdCO0lBRUo7SUFFQSxtREFBbUQ7SUFDbkQsTUFBTWUsaUJBQWlCLElBQUlDLFFBQVFqQixRQUFRQyxPQUFPO0lBQ2xELE1BQU1pQixxQkFBcUJwQixnRkFBK0I7SUFFMUQseUNBQXlDO0lBQ3pDSSxPQUFPRSxPQUFPLENBQUNjLG9CQUFvQkUsT0FBTyxDQUFDLENBQUMsQ0FBQ0MsS0FBS0MsTUFBTTtRQUN0RCxJQUFJQSxPQUFPO1lBQ1ROLGVBQWVPLEdBQUcsQ0FBQ0YsS0FBS0M7UUFDMUI7SUFDRjtJQUVBLGdEQUFnRDtJQUNoRCxNQUFNRSxrQkFBa0IsSUFBSTVCLG9EQUFXQSxDQUFDSSxTQUFTO1FBQy9DQyxTQUFTZTtJQUNYO0lBRUEsc0JBQXNCO0lBQ3RCLE1BQU1TLFdBQVc1QixxREFBWUEsQ0FBQzZCLElBQUksQ0FBQztRQUNqQzFCLFNBQVN3QjtJQUNYO0lBRUEsMENBQTBDO0lBQzFDdEIsT0FBT0UsT0FBTyxDQUFDYyxvQkFBb0JFLE9BQU8sQ0FBQyxDQUFDLENBQUNDLEtBQUtDLE1BQU07UUFDdEQsSUFBSUEsT0FBTztZQUNURyxTQUFTeEIsT0FBTyxDQUFDc0IsR0FBRyxDQUFDRixLQUFLQztRQUM1QjtJQUNGO0lBRUEsK0NBQStDO0lBQy9DRyxTQUFTeEIsT0FBTyxDQUFDc0IsR0FBRyxDQUFDLGdCQUFnQnpCLHVGQUFzQyxJQUFJOEIsYUFBYTtJQUM1RkgsU0FBU3hCLE9BQU8sQ0FBQ3NCLEdBQUcsQ0FBQyxhQUFhekIsdUZBQXNDLElBQUkrQixVQUFVO0lBQ3RGSixTQUFTeEIsT0FBTyxDQUFDc0IsR0FBRyxDQUFDLGNBQWN6Qix1RkFBc0MsSUFBSWdDLFdBQVc7SUFFeEYsMkNBQTJDO0lBQzNDLE1BQU1DLGlCQUFpQmpDLHVGQUFzQztJQUM3RCxJQUFJaUMsZ0JBQWdCO1FBQ2xCLGlEQUFpRDtRQUNqRCxJQUFJLENBQUMvQixRQUFRVyxPQUFPLENBQUNDLFFBQVEsQ0FBQ29CLFVBQVUsQ0FBQyxjQUNyQyxDQUFDaEMsUUFBUVcsT0FBTyxDQUFDQyxRQUFRLENBQUNvQixVQUFVLENBQUMsbUJBQ3JDLENBQUNoQyxRQUFRVyxPQUFPLENBQUNDLFFBQVEsQ0FBQ29CLFVBQVUsQ0FBQyxnQkFBZ0I7WUFDdkRsQyxnRkFBK0IsQ0FBQ2lDLGdCQUFnQjtRQUNsRDtJQUNGO0lBRUEsT0FBT047QUFDVDtBQUVPLE1BQU1TLFNBQVM7SUFDcEJDLFNBQVM7UUFDUDs7Ozs7O0tBTUMsR0FDRDtLQUNEO0FBQ0gsRUFBQyIsInNvdXJjZXMiOlsiL1VzZXJzL21hY21pbmkvRG9jdW1lbnRzL1Byb2plY3RzL1NhYVMgRmFjdG9yeS91aS9uZXh0anMvc3JjL21pZGRsZXdhcmUudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTmV4dFJlcXVlc3QsIE5leHRSZXNwb25zZSB9IGZyb20gJ25leHQvc2VydmVyJ1xuaW1wb3J0IHsgY29ycmVsYXRpb25JRE1hbmFnZXIgfSBmcm9tICcuL2xpYi9jb3JyZWxhdGlvbi1pZCdcblxuZXhwb3J0IGZ1bmN0aW9uIG1pZGRsZXdhcmUocmVxdWVzdDogTmV4dFJlcXVlc3QpIHtcbiAgLy8gRXh0cmFjdCBjb3JyZWxhdGlvbiBJRCBmcm9tIGluY29taW5nIHJlcXVlc3QgaGVhZGVyc1xuICBjb25zdCBoZWFkZXJzID0gT2JqZWN0LmZyb21FbnRyaWVzKHJlcXVlc3QuaGVhZGVycy5lbnRyaWVzKCkpXG4gIGNvbnN0IGNvcnJlbGF0aW9uQ29udGV4dCA9IGNvcnJlbGF0aW9uSURNYW5hZ2VyLmV4dHJhY3RGcm9tSGVhZGVycyhoZWFkZXJzKVxuICBcbiAgLy8gSWYgbm8gY29ycmVsYXRpb24gY29udGV4dCBleGlzdHMsIGNyZWF0ZSBvbmVcbiAgaWYgKCFjb3JyZWxhdGlvbkNvbnRleHQpIHtcbiAgICBjb3JyZWxhdGlvbklETWFuYWdlci5nZW5lcmF0ZUNvbnRleHQoXG4gICAgICB1bmRlZmluZWQsXG4gICAgICB1bmRlZmluZWQsXG4gICAgICB1bmRlZmluZWQsXG4gICAgICB1bmRlZmluZWQsXG4gICAgICB7IFxuICAgICAgICBvcGVyYXRpb246ICdodHRwX3JlcXVlc3QnLCBcbiAgICAgICAgcGF0aDogcmVxdWVzdC5uZXh0VXJsLnBhdGhuYW1lLFxuICAgICAgICBtZXRob2Q6IHJlcXVlc3QubWV0aG9kLFxuICAgICAgICB1c2VyQWdlbnQ6IGhlYWRlcnNbJ3VzZXItYWdlbnQnXSxcbiAgICAgICAgcmVmZXJlcjogaGVhZGVyc1sncmVmZXJlciddXG4gICAgICB9XG4gICAgKVxuICB9XG5cbiAgLy8gQ2xvbmUgdGhlIHJlcXVlc3QgaGVhZGVycyB0byBhZGQgY29ycmVsYXRpb24gSURzXG4gIGNvbnN0IHJlcXVlc3RIZWFkZXJzID0gbmV3IEhlYWRlcnMocmVxdWVzdC5oZWFkZXJzKVxuICBjb25zdCBjb3JyZWxhdGlvbkhlYWRlcnMgPSBjb3JyZWxhdGlvbklETWFuYWdlci5nZXRIZWFkZXJzKClcbiAgXG4gIC8vIEFkZCBjb3JyZWxhdGlvbiBoZWFkZXJzIHRvIHRoZSByZXF1ZXN0XG4gIE9iamVjdC5lbnRyaWVzKGNvcnJlbGF0aW9uSGVhZGVycykuZm9yRWFjaCgoW2tleSwgdmFsdWVdKSA9PiB7XG4gICAgaWYgKHZhbHVlKSB7XG4gICAgICByZXF1ZXN0SGVhZGVycy5zZXQoa2V5LCB2YWx1ZSlcbiAgICB9XG4gIH0pXG5cbiAgLy8gQ3JlYXRlIGEgbmV3IHJlcXVlc3Qgd2l0aCBjb3JyZWxhdGlvbiBoZWFkZXJzXG4gIGNvbnN0IGVuaGFuY2VkUmVxdWVzdCA9IG5ldyBOZXh0UmVxdWVzdChyZXF1ZXN0LCB7XG4gICAgaGVhZGVyczogcmVxdWVzdEhlYWRlcnNcbiAgfSlcblxuICAvLyBQcm9jZXNzIHRoZSByZXF1ZXN0XG4gIGNvbnN0IHJlc3BvbnNlID0gTmV4dFJlc3BvbnNlLm5leHQoe1xuICAgIHJlcXVlc3Q6IGVuaGFuY2VkUmVxdWVzdFxuICB9KVxuXG4gIC8vIEFkZCBjb3JyZWxhdGlvbiBoZWFkZXJzIHRvIHRoZSByZXNwb25zZVxuICBPYmplY3QuZW50cmllcyhjb3JyZWxhdGlvbkhlYWRlcnMpLmZvckVhY2goKFtrZXksIHZhbHVlXSkgPT4ge1xuICAgIGlmICh2YWx1ZSkge1xuICAgICAgcmVzcG9uc2UuaGVhZGVycy5zZXQoa2V5LCB2YWx1ZSlcbiAgICB9XG4gIH0pXG5cbiAgLy8gQWRkIGFkZGl0aW9uYWwgcmVzcG9uc2UgaGVhZGVycyBmb3IgdHJhY2tpbmdcbiAgcmVzcG9uc2UuaGVhZGVycy5zZXQoJ1gtUmVxdWVzdC1JRCcsIGNvcnJlbGF0aW9uSURNYW5hZ2VyLmdldEN1cnJlbnRDb250ZXh0KCk/LnJlcXVlc3RJZCB8fCAnJylcbiAgcmVzcG9uc2UuaGVhZGVycy5zZXQoJ1gtU3Bhbi1JRCcsIGNvcnJlbGF0aW9uSURNYW5hZ2VyLmdldEN1cnJlbnRDb250ZXh0KCk/LnNwYW5JZCB8fCAnJylcbiAgcmVzcG9uc2UuaGVhZGVycy5zZXQoJ1gtVHJhY2UtSUQnLCBjb3JyZWxhdGlvbklETWFuYWdlci5nZXRDdXJyZW50Q29udGV4dCgpPy50cmFjZUlkIHx8ICcnKVxuXG4gIC8vIExvZyB0aGUgcmVxdWVzdCB3aXRoIGNvcnJlbGF0aW9uIGNvbnRleHRcbiAgY29uc3QgY3VycmVudENvbnRleHQgPSBjb3JyZWxhdGlvbklETWFuYWdlci5nZXRDdXJyZW50Q29udGV4dCgpXG4gIGlmIChjdXJyZW50Q29udGV4dCkge1xuICAgIC8vIE9ubHkgbG9nIGZvciBub24tYXNzZXQgcmVxdWVzdHMgdG8gYXZvaWQgbm9pc2VcbiAgICBpZiAoIXJlcXVlc3QubmV4dFVybC5wYXRobmFtZS5zdGFydHNXaXRoKCcvX25leHQvJykgJiYgXG4gICAgICAgICFyZXF1ZXN0Lm5leHRVcmwucGF0aG5hbWUuc3RhcnRzV2l0aCgnL2Zhdmljb24uaWNvJykgJiZcbiAgICAgICAgIXJlcXVlc3QubmV4dFVybC5wYXRobmFtZS5zdGFydHNXaXRoKCcvYXBpL2hlYWx0aCcpKSB7XG4gICAgICBjb3JyZWxhdGlvbklETWFuYWdlci5sb2dDb250ZXh0KGN1cnJlbnRDb250ZXh0LCAnaW5mbycpXG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIHJlc3BvbnNlXG59XG5cbmV4cG9ydCBjb25zdCBjb25maWcgPSB7XG4gIG1hdGNoZXI6IFtcbiAgICAvKlxuICAgICAqIE1hdGNoIGFsbCByZXF1ZXN0IHBhdGhzIGV4Y2VwdCBmb3IgdGhlIG9uZXMgc3RhcnRpbmcgd2l0aDpcbiAgICAgKiAtIGFwaSAoQVBJIHJvdXRlcylcbiAgICAgKiAtIF9uZXh0L3N0YXRpYyAoc3RhdGljIGZpbGVzKVxuICAgICAqIC0gX25leHQvaW1hZ2UgKGltYWdlIG9wdGltaXphdGlvbiBmaWxlcylcbiAgICAgKiAtIGZhdmljb24uaWNvIChmYXZpY29uIGZpbGUpXG4gICAgICovXG4gICAgJy8oKD8hYXBpfF9uZXh0L3N0YXRpY3xfbmV4dC9pbWFnZXxmYXZpY29uLmljbykuKiknLFxuICBdLFxufVxuIl0sIm5hbWVzIjpbIk5leHRSZXF1ZXN0IiwiTmV4dFJlc3BvbnNlIiwiY29ycmVsYXRpb25JRE1hbmFnZXIiLCJtaWRkbGV3YXJlIiwicmVxdWVzdCIsImhlYWRlcnMiLCJPYmplY3QiLCJmcm9tRW50cmllcyIsImVudHJpZXMiLCJjb3JyZWxhdGlvbkNvbnRleHQiLCJleHRyYWN0RnJvbUhlYWRlcnMiLCJnZW5lcmF0ZUNvbnRleHQiLCJ1bmRlZmluZWQiLCJvcGVyYXRpb24iLCJwYXRoIiwibmV4dFVybCIsInBhdGhuYW1lIiwibWV0aG9kIiwidXNlckFnZW50IiwicmVmZXJlciIsInJlcXVlc3RIZWFkZXJzIiwiSGVhZGVycyIsImNvcnJlbGF0aW9uSGVhZGVycyIsImdldEhlYWRlcnMiLCJmb3JFYWNoIiwia2V5IiwidmFsdWUiLCJzZXQiLCJlbmhhbmNlZFJlcXVlc3QiLCJyZXNwb25zZSIsIm5leHQiLCJnZXRDdXJyZW50Q29udGV4dCIsInJlcXVlc3RJZCIsInNwYW5JZCIsInRyYWNlSWQiLCJjdXJyZW50Q29udGV4dCIsInN0YXJ0c1dpdGgiLCJsb2dDb250ZXh0IiwiY29uZmlnIiwibWF0Y2hlciJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(middleware)/./src/middleware.ts\n");

/***/ })

});